<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ΑστυΝομικά | Σύστημα Διαχείρισης Νομοθεσίας</title>
    <meta name="description" content="Ολοκληρωμένο σύστημα διαχείρισης και οργάνωσης αστυνομικής νομοθεσίας">
    
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0a2463">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ΑστυΝομικά">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="ΑστυΝομικά">
    <!-- External Resources -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <style>
        /* ========================================
           CSS VARIABLES & ROOT CONFIGURATION
        ======================================== */
        :root {
            /* Brand Colors - Sophisticated Navy Theme */
            --primary: #0a2463;
            --primary-light: #1e3a8a;
            --primary-dark: #061739;
            --accent: #fb8500;
            --accent-light: #ffb703;
            --accent-dark: #d67100;
            --secondary: #023047;  
            --secondary-light: #0a4a6e;
            --secondary-dark: #011f2f;
            
            /* UI Colors */
            --success: #06d6a0;
            --warning: #fb8500;
            --danger: #ef476f;
            --info: #118ab2;
            --info-light: #3da5c7;
            --info-dark: #0d6a8a;
    
            /* Extended Color Palette */
            --purple: #7209b7;
            --purple-light: #9d4edd;
            --teal: #0fa3b1;
            --coral: #ff6b6b;
            --emerald: #10b981;
            --amber: #f59e0b;
            --indigo: #4f46e5;
            
            /* Neutral Colors */
            --white: #ffffff;
            --bg-main: #f8f9fc;
            --bg-card: #ffffff;
            --text-primary: #1a1d29;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border: #e5e7eb;
            --border-light: #f3f4f6;
            
            /* Dark Mode Colors */
            --dark-bg-main: #0f1419;
            --dark-bg-card: #1a1f2e;
            --dark-bg-elevated: #232938;
            --dark-text-primary: #e8eaed;
            --dark-text-secondary: #9aa0a6;
            --dark-border: #2d3748;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            
            /* Spacing */
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Typography */
            --font-display: 'Playfair Display', Georgia, serif;
            --font-body: 'IBM Plex Sans', -apple-system, system-ui, sans-serif;
        }

        /* ========================================
           GLOBAL STYLES & RESETS
        ======================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-main);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            transition: background-color var(--transition), color var(--transition);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body.dark-mode {
            background-color: var(--dark-bg-main);
            color: var(--dark-text-primary);
        }

        /* ========================================
           UTILITY CLASSES
        ======================================== */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0 24px;
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            margin: -1px;
            padding: 0;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        /* ========================================
           HEADER SECTION
        ======================================== */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-card);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            transition: all var(--transition);
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .dark-mode .app-header {
            background: rgba(26, 31, 46, 0.9);
            border-bottom-color: var(--dark-border);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            gap: 32px;
        }

        /* Logo Section */
        .logo-section {
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            transition: transform var(--transition);
        }

        .logo-section:hover {
            transform: translateX(4px);
        }

        .logo {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .app-title h1 {
            font-family: var(--font-display);
            font-size: 32px;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 2px;
            letter-spacing: -0.5px;
            transition: color var(--transition);
        }

        .app-title h1:hover {
            color: var(--accent);
        }

        .dark-mode .app-title h1 {
            color: var(--accent-light);
        }

        .app-title p {
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .dark-mode .app-title p {
            color: var(--dark-text-secondary);
        }

        /* Header Controls */
        .header-controls {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: var(--bg-main);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .header-btn {
            background: var(--dark-bg-elevated);
            color: var(--dark-text-primary);
        }

        .header-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            opacity: 0;
            transition: opacity var(--transition);
        }

        .header-btn:hover::before {
            opacity: 1;
        }

        .header-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow);
            color: white;
        }

        .header-btn i {
            position: relative;
            z-index: 1;
        }

        .header-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }

        .header-btn.active::before {
            opacity: 1;
        }

        /* ========================================
           MAIN LAYOUT
        ======================================== */
        .main-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 32px;
            padding: 32px 0;
            animation: fadeIn 0.5s ease-out 0.2s both;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ========================================
           SIDEBAR NAVIGATION
        ======================================== */
        .sidebar {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 120px;
            transition: all var(--transition);
        }

        .dark-mode .sidebar {
            background: var(--dark-bg-card);
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            border-radius: var(--radius);
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 15px;
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .nav-link {
            color: var(--dark-text-primary);
        }

        .nav-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            transform: translateX(-100%);
            transition: transform var(--transition);
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--border-light);
            transform: translateX(4px);
            color: var(--primary);
        }

        .dark-mode .nav-link:hover,
        .dark-mode .nav-link.active {
            background: var(--dark-bg-elevated);
            color: var(--accent-light);
        }

        .nav-link:hover::before,
        .nav-link.active::before {
            transform: translateX(0);
        }

        .nav-link i {
            width: 20px;
            text-align: center;
        }

        /* ========================================
           MAIN CONTENT AREA
        ======================================== */
        .main-content {
            min-height: 600px;
        }

        /* Search & Filter Bar */
        .search-filter-bar {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: var(--shadow);
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 16px;
            align-items: center;
        }

        .dark-mode .search-filter-bar {
            background: var(--dark-bg-card);
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 14px 48px 14px 48px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 15px;
            font-family: var(--font-body);
            transition: all var(--transition);
            background: var(--bg-main);
            color: var(--text-primary);
        }

        .dark-mode .search-input {
            background: var(--dark-bg-elevated);
            border-color: var(--dark-border);
            color: var(--dark-text-primary);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(251, 133, 0, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 18px;
        }

        .clear-search {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: all var(--transition);
            opacity: 0;
            pointer-events: none;
        }

        .clear-search.visible {
            opacity: 1;
            pointer-events: all;
        }

        .clear-search:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        /* Filter & Sort */
        .filter-select,
        .sort-select {
            padding: 12px 40px 12px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            background: var(--bg-main);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b7280' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }

        .dark-mode .filter-select,
        .dark-mode .sort-select {
            background-color: var(--dark-bg-elevated);
            border-color: var(--dark-border);
            color: var(--dark-text-primary);
        }

        .filter-select:hover,
        .sort-select:hover {
            border-color: var(--accent);
        }

        .filter-select:focus,
        .sort-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(251, 133, 0, 0.1);
        }

        /* Action Buttons */
        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all var(--transition);
            font-family: var(--font-body);
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            box-shadow: var(--shadow);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--accent), var(--primary));
            opacity: 0;
            transition: opacity var(--transition);
        }

        .btn-primary:hover::before {
            opacity: 1;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary span,
        .btn-primary i {
            position: relative;
            z-index: 1;
        }

        /* ========================================
           LEGISLATION CARDS
        ======================================== */
        .legislation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: 24px;
            animation: fadeInUp 0.5s ease-out;
        }

        .legislation-grid.list-view {
            grid-template-columns: 1fr;
        }

        .legislation-grid.list-view .legislation-card {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 20px;
            align-items: center;
        }

        .legislation-grid.list-view .card-header {
            margin-bottom: 0;
        }

        .legislation-grid.list-view .card-title {
            margin-bottom: 4px;
        }

        .legislation-grid.list-view .card-number {
            margin-bottom: 0;
        }

        .legislation-grid.list-view .card-meta {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
            justify-content: flex-end;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .legislation-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: all var(--transition);
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .dark-mode .legislation-card {
            background: var(--dark-bg-card);
        }

        .legislation-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform var(--transition);
        }

        .legislation-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent);
        }

        .legislation-card:hover::before {
            transform: scaleX(1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .card-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-law { background: rgba(6, 214, 160, 0.1); color: var(--success); }
        .badge-decree { background: rgba(251, 133, 0, 0.1); color: var(--accent); }
        .badge-circular { background: rgba(17, 138, 178, 0.1); color: var(--info); }
        .badge-decision { background: rgba(239, 71, 111, 0.1); color: var(--danger); }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .dark-mode .card-title {
            color: var(--dark-text-primary);
        }

        .card-number {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 12px;
        }

        .dark-mode .card-number {
            color: var(--dark-text-secondary);
        }

        .card-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .dark-mode .card-meta {
            border-top-color: var(--dark-border);
            color: var(--dark-text-secondary);
        }

        .card-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* ========================================
           MODALS
        ======================================== */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 24px;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .dark-mode .modal-content {
            background: var(--dark-bg-card);
        }

        .modal-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-mode .modal-header {
            border-bottom-color: var(--dark-border);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            word-wrap: break-word;
        }

        .dark-mode .modal-title {
            color: var(--dark-text-primary);
        }

        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: var(--border-light);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition);
        }

        .dark-mode .modal-close {
            background: var(--dark-bg-elevated);
            color: var(--dark-text-secondary);
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 32px;
            overflow-y: auto;
            flex: 1;
            min-height: 0;
        }

        /* ========================================
           FORMS
        ======================================== */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .dark-mode .form-label {
            color: var(--dark-text-primary);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-size: 15px;
            font-family: var(--font-body);
            transition: all var(--transition);
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .dark-mode .form-input,
        .dark-mode .form-textarea,
        .dark-mode .form-select {
            background: var(--dark-bg-elevated);
            border-color: var(--dark-border);
            color: var(--dark-text-primary);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(251, 133, 0, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Editor Container */
        .editor-container {
            border: 2px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            transition: all var(--transition);
        }

        .dark-mode .editor-container {
            border-color: var(--dark-border);
        }

        .editor-container:focus-within {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(251, 133, 0, 0.1);
        }

        .ql-toolbar {
            background: var(--bg-main);
            border: none !important;
            border-bottom: 1px solid var(--border) !important;
        }

        .dark-mode .ql-toolbar {
            background: var(--dark-bg-main);
            border-bottom-color: var(--dark-border) !important;
        }

        .ql-container {
            font-size: 15px;
            font-family: var(--font-body);
            min-height: 300px;
            border: none !important;
            background: var(--bg-card);
        }

        .dark-mode .ql-container {
            background: var(--dark-bg-elevated);
            color: var(--dark-text-primary);
        }

        /* ========================================
           STATISTICS DASHBOARD
        ======================================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: all var(--transition);
            position: relative;
            overflow: hidden;
        }

        .dark-mode .stat-card {
            background: var(--dark-bg-card);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            opacity: 0.05;
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .dark-mode .stat-value {
            color: var(--dark-text-primary);
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .dark-mode .stat-label {
            color: var(--dark-text-secondary);
        }

        /* Chart Container */
        .chart-container {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 32px;
        }

        .dark-mode .chart-container {
            background: var(--dark-bg-card);
        }

        .chart-header {
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .dark-mode .chart-title {
            color: var(--dark-text-primary);
        }

        /* ========================================
           SETTINGS PANEL
        ======================================== */
        .settings-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .dark-mode .settings-section {
            background: var(--dark-bg-card);
        }

        .settings-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }

        .dark-mode .settings-title {
            color: var(--dark-text-primary);
            border-bottom-color: var(--dark-border);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .dark-mode .setting-item {
            border-bottom-color: var(--dark-border);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .dark-mode .setting-info h4 {
            color: var(--dark-text-primary);
        }

        .setting-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .dark-mode .setting-info p {
            color: var(--dark-text-secondary);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 56px;
            height: 32px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--border);
            transition: var(--transition);
            border-radius: 32px;
        }

        .dark-mode .toggle-slider {
            background: var(--dark-border);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: var(--transition);
            border-radius: 50%;
            box-shadow: var(--shadow-sm);
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, var(--primary), var(--accent));
        }

        input:checked + .toggle-slider::before {
            transform: translateX(24px);
        }

        /* Color Picker */
        .color-picker-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
        }

        .color-option {
            position: relative;
        }

        .color-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .color-option label {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all var(--transition);
        }

        .dark-mode .color-option label {
            border-color: var(--dark-border);
        }

        .color-preview {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            box-shadow: var(--shadow);
        }

        .color-option input:checked + label {
            border-color: var(--accent);
            background: rgba(251, 133, 0, 0.05);
        }

        .color-option label:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* ========================================
           TAGS STYLING
        ======================================== */
        .tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            color: white;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .tag:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: linear-gradient(135deg, var(--primary), var(--accent));
        }

        .tag .remove-tag {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 10px;
            color: white;
            transition: all var(--transition);
        }

        .tag .remove-tag:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .dark-mode .tag {
            background: linear-gradient(135deg, var(--accent-dark), var(--accent));
        }

        /* ========================================
           FAVORITE BUTTON STYLING
        ======================================== */
        #favoriteBtn {
            transition: all var(--transition);
        }

        #favoriteBtn.is-favorite i {
            color: var(--danger);
        }

        #favoriteBtn:hover {
            transform: scale(1.1);
        }

        #favoriteBtn.is-favorite:hover {
            animation: heartBeat 0.3s ease-in-out;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1.1); }
            50% { transform: scale(1.3); }
        }

        /* ========================================
           LEGISLATION CONTENT STYLING
        ======================================== */
        .legislation-content {
            line-height: 1.8;
            font-size: 15px;
            color: var(--text-primary);
        }

        .legislation-content p {
            margin-bottom: 1em;
            color: inherit;
        }

        .legislation-content h1,
        .legislation-content h2,
        .legislation-content h3,
        .legislation-content h4,
        .legislation-content h5,
        .legislation-content h6 {
            color: inherit;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }

        .legislation-content ul,
        .legislation-content ol {
            margin-bottom: 1em;
            padding-left: 2em;
        }

        .legislation-content li {
            margin-bottom: 0.5em;
        }

        /* Dark mode - much brighter text for better readability */
        .dark-mode .legislation-content {
            color: #d1d5db !important;
        }

        .dark-mode .legislation-content p {
            color: #d1d5db !important;
        }

        .dark-mode .legislation-content * {
            color: #d1d5db !important;
        }

        .dark-mode .legislation-content h1,
        .dark-mode .legislation-content h2,
        .dark-mode .legislation-content h3,
        .dark-mode .legislation-content h4,
        .dark-mode .legislation-content h5,
        .dark-mode .legislation-content h6 {
            color: #e5e7eb !important;
        }

        .dark-mode .legislation-content strong,
        .dark-mode .legislation-content b {
            color: #f3f4f6 !important;
        }

        .dark-mode .legislation-content a {
            color: #93c5fd !important;
        }

        /* Override Quill's inline color styles in dark mode */
        .dark-mode #viewContent * {
            color: #d1d5db !important;
        }

        .dark-mode #viewContent p,
        .dark-mode #viewContent span,
        .dark-mode #viewContent div {
            color: #d1d5db !important;
        }

        .dark-mode #viewContent strong,
        .dark-mode #viewContent b {
            color: #f3f4f6 !important;
        }

        /* ========================================
           RESPONSIVE DESIGN - FIXED FOR MOBILE
        ======================================== */
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: static;
            }

            .legislation-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }

            /* FIX: Σωστή διάταξη για το dashboard σε tablet */
            #dashboardView > div:first-child {
                display: flex !important;
                flex-direction: column !important;
                gap: 24px !important;
            }
            
            #dashboardView > div:first-child > div:first-child {
                width: 100% !important;
            }
            
            #dashboardView > div:first-child > .chart-container {
                width: 100% !important;
                margin-top: 0 !important;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }

            .header-content {
                gap: 16px;
            }

            .app-title h1 {
                font-size: 24px;
            }

            .logo {
                width: 48px;
                height: 48px;
                font-size: 24px;
            }

            .header-btn {
                width: 44px;
                height: 44px;
                font-size: 16px;
            }

            .search-filter-bar {
                grid-template-columns: 1fr;
            }

            .legislation-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                max-width: 100%;
                max-height: 100vh;
                border-radius: 0;
            }

            .modal-body {
                padding: 16px 12px;
            }

            .modal-header {
                padding: 12px;
            }

            .modal-title {
                font-size: 16px;
                line-height: 1.4;
                max-height: 2.8em;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
            }

            /* Reduce spacing in view modal on mobile */
            #viewModal .modal-body > div {
                margin-bottom: 12px !important;
            }

            #viewModal .modal-body > div:first-child {
                margin-bottom: 12px !important;
            }

            #viewModal .modal-body > div:nth-child(2) {
                margin-bottom: 12px !important;
                padding-bottom: 12px !important;
            }

            .header-btn {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }

            .modal-close {
                width: 36px;
                height: 36px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            /* FIX: Σωστή διάταξη για το dashboard σε κινητά */
            #dashboardView > div:first-child {
                display: flex !important;
                flex-direction: column !important;
                gap: 24px !important;
            }
            
            #dashboardView > div:first-child > div:first-child {
                width: 100% !important;
            }
            
            #dashboardView > div:first-child > .chart-container {
                width: 100% !important;
                margin-top: 0 !important;
            }
            
            /* FIX: Κουμπί "Νέα Νομοθεσία" σε μικρές οθόνες */
            #legislationView > div:nth-child(2) {
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 16px !important;
            }
            
            #legislationView > div:nth-child(2) > button {
                width: 100% !important;
            }
            
            #legislationView > div:nth-child(2) > div {
                display: flex;
                justify-content: center;
                gap: 8px;
            }
        }

        /* ========================================
           LOADING & ANIMATIONS
        ======================================== */
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, var(--border) 25%, var(--border-light) 50%, var(--border) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ========================================
           SEARCH HIGHLIGHTS
        ======================================== */
        .highlight {
            background: rgba(251, 133, 0, 0.2);
            padding: 2px 4px;
            border-radius: 3px;
            transition: all var(--transition);
        }

        .highlight.current {
            background: var(--accent);
            color: white;
            font-weight: 600;
        }

        /* ========================================
           TOAST NOTIFICATIONS
        ======================================== */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--bg-card);
            padding: 16px 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 2000;
            animation: slideInRight 0.3s ease-out;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .dark-mode .toast {
            background: var(--dark-bg-card);
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }
        .toast.info { border-left: 4px solid var(--info); }

        /* ========================================
           EMPTY STATES
        ======================================== */
        .empty-state {
            text-align: center;
            padding: 64px 24px;
        }

        .empty-icon {
            font-size: 64px;
            color: var(--text-muted);
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .dark-mode .empty-title {
            color: var(--dark-text-primary);
        }

        .empty-description {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        .dark-mode .empty-description {
            color: var(--dark-text-secondary);
        }

        /* ========================================
           PRINT STYLES
        ======================================== */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #viewModal.active,
            #viewModal.active * {
                visibility: visible;
            }
            
            #viewModal.active {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white;
            }
            
            .app-header,
            .sidebar,
            .search-filter-bar,
            .header-controls,
            .action-btn,
            .modal-header button,
            #searchInText,
            #searchResultsInfo,
            .legislation-grid,
            #dashboardView,
            #legislationView,
            #statisticsView,
            #settingsView {
                display: none !important;
                visibility: hidden !important;
            }

            body {
                background: white;
                color: black;
            }

            .modal {
                position: static;
                background: white;
                display: block !important;
            }

            .modal-content {
                box-shadow: none;
                max-width: 100%;
                max-height: none;
                border-radius: 0;
            }

            .modal-header {
                border-bottom: 2px solid #000;
            }

            .modal-body {
                padding: 20px 0;
            }

            .main-layout {
                grid-template-columns: 1fr;
            }

            .legislation-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ccc;
            }

            .highlight {
                background: transparent !important;
                color: inherit !important;
            }
        }

        /* Dark mode specific classes */
        .dark-mode .dark-mode-border {
            border-color: var(--dark-border) !important;
        }

        .dark-mode .dark-mode-bg {
            background: var(--dark-bg-elevated) !important;
        }

        /* Item list styling for settings */
        .setting-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg-main);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            transition: all var(--transition);
        }

        .dark-mode .setting-list-item {
            background: var(--dark-bg-elevated);
            border-color: var(--dark-border);
        }

        .setting-list-item:hover {
            border-color: var(--accent);
        }

        .setting-list-item button {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: var(--danger);
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all var(--transition);
        }

        .setting-list-item button:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow);
        }

        /* ========================================
           ACCESSIBILITY IMPROVEMENTS
        ======================================== */
        *:focus-visible {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* ========================================
           SCROLLBAR STYLING
        ======================================== */
        ::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-main);
        }

        .dark-mode ::-webkit-scrollbar-track {
            background: var(--dark-bg-main);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 6px;
            border: 2px solid var(--bg-main);
        }

        .dark-mode ::-webkit-scrollbar-thumb {
            background: var(--dark-border);
            border-color: var(--dark-bg-main);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* ========================================
           QUILL CUSTOM FONTS
        ======================================== */
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="sans-serif"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="sans-serif"]::before {
            content: 'Sans Serif';
            font-family: sans-serif;
        }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="arial"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="arial"]::before {
            content: 'Arial';
            font-family: Arial, sans-serif;
        }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="times-new-roman"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="times-new-roman"]::before {
            content: 'Times New Roman';
            font-family: 'Times New Roman', serif;
        }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="georgia"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="georgia"]::before {
            content: 'Georgia';
            font-family: Georgia, serif;
        }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="courier"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="courier"]::before {
            content: 'Courier';
            font-family: 'Courier New', monospace;
        }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="roboto"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="roboto"]::before {
            content: 'Roboto';
            font-family: 'Roboto', sans-serif;
        }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="open-sans"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="open-sans"]::before {
            content: 'Open Sans';
            font-family: 'Open Sans', sans-serif;
        }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="lato"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="lato"]::before {
            content: 'Lato';
            font-family: 'Lato', sans-serif;
        }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="montserrat"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="montserrat"]::before {
            content: 'Montserrat';
            font-family: 'Montserrat', sans-serif;
        }
        .ql-snow .ql-picker.ql-font .ql-picker-label[data-value="merriweather"]::before,
        .ql-snow .ql-picker.ql-font .ql-picker-item[data-value="merriweather"]::before {
            content: 'Merriweather';
            font-family: 'Merriweather', serif;
        }

        /* Apply fonts in editor content */
        .ql-font-sans-serif { font-family: sans-serif; }
        .ql-font-arial { font-family: Arial, sans-serif; }
        .ql-font-times-new-roman { font-family: 'Times New Roman', serif; }
        .ql-font-georgia { font-family: Georgia, serif; }
        .ql-font-courier { font-family: 'Courier New', monospace; }
        .ql-font-roboto { font-family: 'Roboto', sans-serif; }
        .ql-font-open-sans { font-family: 'Open Sans', sans-serif; }
        .ql-font-lato { font-family: 'Lato', sans-serif; }
        .ql-font-montserrat { font-family: 'Montserrat', sans-serif; }
        .ql-font-merriweather { font-family: 'Merriweather', serif; }

        /* Better table styles */
        .quill-better-table {
            border-collapse: collapse;
        }
        
        .quill-better-table td,
        .quill-better-table th {
            border: 1px solid var(--border);
            padding: 8px 12px;
            min-width: 50px;
        }

        .dark-mode .quill-better-table td,
        .dark-mode .quill-better-table th {
            border-color: var(--dark-border);
        }

        .quill-better-table-wrapper {
            overflow-x: auto;
        }

        /* Related legislation custom search styles */
        .related-option-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            margin-bottom: 6px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition);
            background: var(--bg-card);
        }

        .dark-mode .related-option-item {
            background: var(--dark-bg-elevated);
            border-color: var(--dark-border);
        }

        .related-option-item:hover {
            background: var(--border-light);
            border-color: var(--accent);
            transform: translateX(4px);
        }

        .dark-mode .related-option-item:hover {
            background: var(--dark-bg-main);
        }

        .related-option-item.selected {
            background: rgba(251, 133, 0, 0.1);
            border-color: var(--accent);
        }

        .related-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .related-info {
            flex: 1;
        }

        .related-number {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }

        .dark-mode .related-number {
            color: var(--dark-text-primary);
        }

        .related-title {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
            line-height: 1.3;
        }

        .dark-mode .related-title {
            color: var(--dark-text-secondary);
        }
    </style>
</head>
<body>
    <!-- ========================================
         HEADER
    ======================================== -->
    <header class="app-header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section" onclick="showView('dashboard')">
                    <div class="logo">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <div class="app-title">
                        <h1>ΑστυΝομικά</h1>
                        <p>Διαχείρισης Νομοθεσίας</p>
                    </div>
                </div>

                <div class="header-controls">
                    <button class="header-btn" onclick="createBackup()" title="Δημιουργία Backup (Ctrl+B)" aria-label="Δημιουργία αντιγράφου ασφαλείας">
                        <i class="fas fa-save"></i>
                    </button>
                    <button class="header-btn" onclick="toggleTheme()" title="Αλλαγή θέματος" aria-label="Εναλλαγή σκοτεινού/φωτεινού θέματος">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>
                    <button class="header-btn" onclick="showView('settings')" title="Ρυθμίσεις" aria-label="Ανοίγμα ρυθμίσεων">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button class="header-btn" onclick="exportData()" title="Εξαγωγή δεδομένων" aria-label="Εξαγωγή δεδομένων">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ========================================
         MAIN CONTENT
    ======================================== -->
    <div class="container">
        <div class="main-layout">
            <!-- SIDEBAR -->
            <aside class="sidebar">
                <nav aria-label="Κύρια πλοήγηση">
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" onclick="showView('dashboard'); return false;" data-view="dashboard">
                                <i class="fas fa-home"></i>
                                <span>Αρχική</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" onclick="showView('legislation'); return false;" data-view="legislation">
                                <i class="fas fa-book"></i>
                                <span>Νομοθεσία</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" onclick="showView('search'); return false;" data-view="search">
                                <i class="fas fa-search"></i>
                                <span>Αναζήτηση</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" onclick="showView('statistics'); return false;" data-view="statistics">
                                <i class="fas fa-chart-line"></i>
                                <span>Στατιστικά</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" onclick="showView('settings'); return false;" data-view="settings">
                                <i class="fas fa-cog"></i>
                                <span>Ρυθμίσεις</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" onclick="showView('instructions'); return false;" data-view="instructions">
                                <i class="fas fa-book-open"></i>
                                <span>Οδηγίες</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" onclick="showView('contact'); return false;" data-view="contact">
                                <i class="fas fa-envelope"></i>
                                <span>Επικοινωνία</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </aside>

            <!-- MAIN CONTENT -->
            <main class="main-content" role="main">
                <!-- DASHBOARD VIEW -->
                <div id="dashboardView" class="view-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(6, 214, 160, 0.1); color: var(--success);">
                                <i class="fas fa-book"></i>
                            </div>
                            <div class="stat-value" id="totalLegislation">0</div>
                            <div class="stat-label">Σύνολο Νομοθεσιών</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(251, 133, 0, 0.1); color: var(--accent);">
                                <i class="fas fa-folder"></i>
                            </div>
                            <div class="stat-value" id="totalCategories">0</div>
                            <div class="stat-label">Κατηγορίες</div>
                        </div>
                        <!-- ΤΡΟΠΟΠΟΙΗΜΕΝΟ 1: Κάνε το tags box clickable -->
                        <div class="stat-card" onclick="showTagsList()" style="cursor: pointer; transition: all var(--transition);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='var(--shadow-lg)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow)';">
                            <div class="stat-icon" style="background: rgba(251, 133, 0, 0.1); color: var(--accent);">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="stat-value" id="totalTags">0</div>
                            <div class="stat-label">Ετικέτες</div>
                        </div>
                        <div class="stat-card" onclick="showFavorites()" style="cursor: pointer; transition: all var(--transition);" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='var(--shadow-lg)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow)';">
                            <div class="stat-icon" style="background: rgba(239, 71, 111, 0.1); color: var(--danger);">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="stat-value" id="favoritesCount">0</div>
                            <div class="stat-label">Αγαπημένα</div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px;">
                        <div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                                <h2 style="font-size: 24px; font-weight: 700;">Πρόσφατες Νομοθεσίες</h2>
                                <div style="display: flex; gap: 8px;">
                                    <button class="header-btn" onclick="toggleViewMode('grid', 'recentLegislation')" id="gridViewBtnDashboard" title="Προβολή πλέγματος">
                                        <i class="fas fa-th"></i>
                                    </button>
                                    <button class="header-btn" onclick="toggleViewMode('list', 'recentLegislation')" id="listViewBtnDashboard" title="Προβολή λίστας">
                                        <i class="fas fa-list"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="legislation-grid" id="recentLegislation" style="grid-template-columns: 1fr;"></div>
                        </div>
                        
                        <div class="chart-container" style="height: fit-content;">
                            <div class="chart-header">
                                <h3 class="chart-title" style="font-size: 16px;">Κατανομή ανά Κατηγορία</h3>
                            </div>
                            <div style="max-height: 300px;">
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LEGISLATION VIEW -->
                <div id="legislationView" class="view-content" style="display: none;">
                    <div class="search-filter-bar">
                        <div class="search-box">
                            <i class="fas fa-search search-icon"></i>
                            <input 
                                type="text" 
                                class="search-input" 
                                id="searchInput" 
                                placeholder="Αναζήτηση νομοθεσίας..."
                                aria-label="Αναζήτηση νομοθεσίας"
                            >
                            <button class="clear-search" id="clearSearch" onclick="clearSearch()" aria-label="Καθαρισμός αναζήτησης">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <select class="filter-select" id="categoryFilter" onchange="filterLegislation()" aria-label="Φίλτρο κατηγορίας">
                            <option value="">Όλες οι Κατηγορίες</option>
                        </select>
                        <select class="sort-select" id="sortSelect" onchange="sortLegislation()" aria-label="Ταξινόμηση">
                            <option value="newest">Νεότερα Πρώτα</option>
                            <option value="oldest">Παλαιότερα Πρώτα</option>
                            <option value="title_asc">Τίτλος (Α-Ω)</option>
                            <option value="title_desc">Τίτλος (Ω-Α)</option>
                        </select>
                    </div>

                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <button class="action-btn btn-primary" onclick="openAddModal()">
                            <i class="fas fa-plus"></i>
                            <span>Νέα Νομοθεσία</span>
                        </button>

                        <div style="display: flex; gap: 8px;">
                            <button class="header-btn" onclick="toggleViewMode('grid')" id="gridViewBtn" title="Προβολή πλέγματος">
                                <i class="fas fa-th"></i>
                            </button>
                            <button class="header-btn" onclick="toggleViewMode('list')" id="listViewBtn" title="Προβολή λίστας">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                    </div>

                    <div class="legislation-grid" id="legislationGrid"></div>

                    <div id="emptyState" class="empty-state" style="display: none;">
                        <div class="empty-icon">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <h3 class="empty-title">Δεν βρέθηκαν νομοθεσίες</h3>
                        <p class="empty-description">Προσθέστε νέες νομοθεσίες για να ξεκινήσετε</p>
                        <button class="action-btn btn-primary" onclick="openAddModal()">
                            <i class="fas fa-plus"></i>
                            <span>Προσθήκη Νομοθεσίας</span>
                        </button>
                    </div>
                </div>
                <!-- STATISTICS VIEW -->
                <div id="statisticsView" class="view-content" style="display: none;">
                    <h2 style="margin-bottom: 24px; font-size: 28px; font-weight: 700;">Στατιστικά Στοιχεία</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(6, 214, 160, 0.1); color: var(--success);">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="stat-value" id="statTotalDocs">0</div>
                            <div class="stat-label">Συνολικά Έγγραφα</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(251, 133, 0, 0.1); color: var(--accent);">
                                <i class="fas fa-calendar-week"></i>
                            </div>
                            <div class="stat-value" id="statThisMonth">0</div>
                            <div class="stat-label">Αυτόν τον Μήνα</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(17, 138, 178, 0.1); color: var(--info);">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="stat-value" id="statCategories">0</div>
                            <div class="stat-label">Ενεργές Κατηγορίες</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background: rgba(239, 71, 111, 0.1); color: var(--danger);">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="stat-value" id="statViews">0</div>
                            <div class="stat-label">Συνολικές Προβολές</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Κατανομή ανά Τύπο Νομοθεσίας</h3>
                        </div>
                        <canvas id="typeChart"></canvas>
                    </div>

                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">Χρονολογική Εξέλιξη Νομοθεσιών</h3>
                        </div>
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>

                <!-- SETTINGS VIEW -->
                <div id="settingsView" class="view-content" style="display: none;">
                    <h2 style="margin-bottom: 32px; font-size: 28px; font-weight: 700;">Ρυθμίσεις Εφαρμογής</h2>

                    <div class="settings-section">
                        <h3 class="settings-title">Γενικές Ρυθμίσεις</h3>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Σκοτεινό Θέμα</h4>
                                <p>Ενεργοποίηση σκοτεινής λειτουργίας</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkModeToggle" onchange="toggleTheme()">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h4>Αυτόματη Αποθήκευση</h4>
                                <p>Αυτόματη αποθήκευση αλλαγών</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoSaveToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="settings-title">Εμφάνιση</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Χρωματική Παλέτα</label>
                            <div class="color-picker-group">
                                <div class="color-option">
                                    <input type="radio" name="colorTheme" id="themeBlue" value="blue" checked>
                                    <label for="themeBlue">
                                        <div class="color-preview" style="background: linear-gradient(135deg, #0a2463, #fb8500);"></div>
                                        <span>Μπλε/Πορτοκαλί</span>
                                    </label>
                                </div>
                                <div class="color-option">
                                    <input type="radio" name="colorTheme" id="themeGreen" value="green">
                                    <label for="themeGreen">
                                        <div class="color-preview" style="background: linear-gradient(135deg, #065f46, #10b981);"></div>
                                        <span>Πράσινο</span>
                                    </label>
                                </div>
                                <div class="color-option">
                                    <input type="radio" name="colorTheme" id="themePurple" value="purple">
                                    <label for="themePurple">
                                        <div class="color-preview" style="background: linear-gradient(135deg, #5b21b6, #a855f7);"></div>
                                        <span>Μωβ</span>
                                    </label>
                                </div>
                                <div class="color-option">
                                    <input type="radio" name="colorTheme" id="themeRed" value="red">
                                    <label for="themeRed">
                                        <div class="color-preview" style="background: linear-gradient(135deg, #991b1b, #ef4444);"></div>
                                        <span>Κόκκινο</span>
                                    </label>
                                </div>
                                <div class="color-option">
                                    <input type="radio" name="colorTheme" id="themeTeal" value="teal">
                                    <label for="themeTeal">
                                        <div class="color-preview" style="background: linear-gradient(135deg, #0fa3b1, #40c9d4);"></div>
                                        <span>Τιρκουάζ</span>
                                    </label>
                                </div>
                                <div class="color-option">
                                    <input type="radio" name="colorTheme" id="themeCoral" value="coral">
                                    <label for="themeCoral">
                                        <div class="color-preview" style="background: linear-gradient(135deg, #ff6b6b, #ff8787);"></div>
                                        <span>Κοραλί</span>
                                    </label>
                                </div>
                                <div class="color-option">
                                    <input type="radio" name="colorTheme" id="themeAmber" value="amber">
                                    <label for="themeAmber">
                                        <div class="color-preview" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);"></div>
                                        <span>Κεχριμπάρι</span>
                                    </label>
                                </div>
                                <div class="color-option">
                                    <input type="radio" name="colorTheme" id="themeDarkBlue" value="darkblue">
                                    <label for="themeDarkBlue">
                                        <div class="color-preview" style="background: linear-gradient(135deg, #1e3a8a, #dc2626);"></div>
                                        <span>Σκούρο Μπλε/Κόκκινο</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="settings-title">Δεδομένα</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            <button class="action-btn btn-primary" onclick="exportData()">
                                <i class="fas fa-download"></i>
                                <span>Εξαγωγή Δεδομένων</span>
                            </button>
                            <button class="action-btn" style="background: var(--info); color: white;" onclick="importData()">
                                <i class="fas fa-upload"></i>
                                <span>Εισαγωγή Δεδομένων</span>
                            </button>
                            <button class="action-btn" style="background: var(--danger); color: white;" onclick="clearAllData()">
                                <i class="fas fa-trash-alt"></i>
                                <span>Διαγραφή Όλων</span>
                            </button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="settings-title">Διαχείριση Τύπων Νομοθεσίας</h3>
                        
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                                <input type="text" class="form-input" id="newLegislationType" placeholder="Νέος τύπος νομοθεσίας" style="flex: 1;">
                                <button class="action-btn btn-primary" onclick="addLegislationType()">
                                    <i class="fas fa-plus"></i>
                                    <span>Προσθήκη</span>
                                </button>
                            </div>
                            <div id="legislationTypesList" style="display: flex; flex-direction: column; gap: 8px;"></div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="settings-title">Διαχείριση Κατηγοριών</h3>
                        
                        <div style="margin-bottom: 16px;">
                            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                                <input type="text" class="form-input" id="newCategory" placeholder="Νέα κατηγορία" style="flex: 1;">
                                <button class="action-btn btn-primary" onclick="addCategory()">
                                    <i class="fas fa-plus"></i>
                                    <span>Προσθήκη</span>
                                </button>
                            </div>
                            <div id="categoriesList" style="display: flex; flex-direction: column; gap: 8px;"></div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 class="settings-title">Εγκατάσταση Εφαρμογής</h3>
                        
                        <div class="setting-item" style="flex-direction: column; align-items: flex-start;">
                            <div class="setting-info" style="margin-bottom: 16px;">
                                <h4>Προσθήκη στην Αρχική Οθόνη</h4>
                                <p>Εγκαταστήστε την εφαρμογή για γρήγορη πρόσβαση και offline χρήση</p>
                            </div>
                            <button class="action-btn" style="background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; width: 100%;" onclick="showPWABanner()">
                                <i class="fas fa-mobile-alt"></i>
                                <span>Εγκατάσταση Εφαρμογής</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- INSTRUCTIONS VIEW -->
                <div id="instructionsView" class="view-content" style="display: none;">
                    <div style="max-width: 1200px; margin: 0 auto;">
                        <h2 style="margin-bottom: 32px; font-size: 32px; font-weight: 700; display: flex; align-items: center; gap: 16px;">
                            <i class="fas fa-book-open" style="color: var(--accent);"></i>
                            Οδηγίες Χρήσης
                        </h2>
                        
                        <div style="background: linear-gradient(135deg, rgba(10, 36, 99, 0.05), rgba(251, 133, 0, 0.05)); padding: 32px; border-radius: var(--radius-lg); border: 1px solid var(--border); margin-bottom: 24px; box-shadow: var(--shadow-md);">
                            <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; font-size: 24px;">
                                <div style="width: 48px; height: 48px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-file-import"></i>
                                </div>
                                Εισαγωγή Δεδομένων (JSON)
                            </h3>
                            <ol style="margin-left: 20px; line-height: 2; color: var(--text-secondary); font-size: 16px;">
                                <li style="margin-bottom: 12px;">Μεταβείτε στις <strong>Ρυθμίσεις</strong> → <strong>Δεδομένα</strong></li>
                                <li style="margin-bottom: 12px;">Κάντε κλικ στο κουμπί <strong>"Εισαγωγή Δεδομένων"</strong></li>
                                <li style="margin-bottom: 12px;">Επιλέξτε το αρχείο <code style="background: var(--bg-card); padding: 2px 8px; border-radius: 4px; font-family: monospace;">.json</code> από τον υπολογιστή σας</li>
                                <li style="margin-bottom: 12px;">Το σύστημα θα φορτώσει αυτόματα όλες τις νομοθεσίες</li>
                                <li style="margin-bottom: 12px;"><strong style="color: var(--danger);">⚠️ Προσοχή:</strong> Η εισαγωγή θα <em>αντικαταστήσει</em> τα υπάρχοντα δεδομένα</li>
                            </ol>
                        </div>

                        <div style="background: linear-gradient(135deg, rgba(6, 214, 160, 0.05), rgba(17, 138, 178, 0.05)); padding: 32px; border-radius: var(--radius-lg); border: 1px solid var(--border); margin-bottom: 24px; box-shadow: var(--shadow-md);">
                            <h3 style="color: var(--success); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; font-size: 24px;">
                                <div style="width: 48px; height: 48px; background: var(--info); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-file-export"></i>
                                </div>
                                Εξαγωγή Δεδομένων (JSON)
                            </h3>
                            <ol style="margin-left: 20px; line-height: 2; color: var(--text-secondary); font-size: 16px;">
                                <li style="margin-bottom: 12px;">Μεταβείτε στις <strong>Ρυθμίσεις</strong> → <strong>Δεδομένα</strong></li>
                                <li style="margin-bottom: 12px;">Κάντε κλικ στο κουμπί <strong>"Εξαγωγή Δεδομένων"</strong></li>
                                <li style="margin-bottom: 12px;">Το αρχείο <code style="background: var(--bg-card); padding: 2px 8px; border-radius: 4px; font-family: monospace;">.json</code> θα ληφθεί αυτόματα</li>
                                <li style="margin-bottom: 12px;">Το όνομα θα είναι: <code style="background: var(--bg-card); padding: 2px 8px; border-radius: 4px; font-family: monospace;">astynomika-data-YYYY-MM-DD.json</code></li>
                                <li style="margin-bottom: 12px;">Χρησιμοποιήστε το για <strong>backup</strong> ή <strong>μεταφορά δεδομένων</strong></li>
                            </ol>
                        </div>


                        <div style="background: linear-gradient(135deg, rgba(17, 138, 178, 0.05), rgba(114, 9, 183, 0.05)); padding: 32px; border-radius: var(--radius-lg); border: 1px solid var(--border); margin-bottom: 24px; box-shadow: var(--shadow-md);">
                            <h3 style="color: var(--info); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; font-size: 24px;">
                                <div style="width: 48px; height: 48px; background: var(--purple); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-mobile-alt"></i>
                                </div>
                                Εγκατάσταση Εφαρμογής (PWA)
                            </h3>
                            
                            <div style="margin-bottom: 24px;">
                                <h4 style="color: var(--primary); margin-bottom: 12px; font-size: 18px; font-weight: 600;">
                                    <i class="fas fa-robot" style="color: var(--accent);"></i> Αυτόματη Εγκατάσταση (Συνιστάται)
                                </h4>
                                <ol style="margin-left: 20px; line-height: 2; color: var(--text-secondary); font-size: 16px;">
                                    <li style="margin-bottom: 12px;">Μεταβείτε στις <strong>Ρυθμίσεις</strong> → <strong>Εγκατάσταση Εφαρμογής</strong></li>
                                    <li style="margin-bottom: 12px;">Κάντε κλικ στο κουμπί <strong>"Εγκατάσταση Εφαρμογής"</strong></li>
                                    <li style="margin-bottom: 12px;">Ακολουθήστε τις οδηγίες που θα εμφανιστούν</li>
                                </ol>
                            </div>

                            <div style="margin-bottom: 24px; padding-top: 20px; border-top: 1px dashed var(--border);">
                                <h4 style="color: var(--primary); margin-bottom: 12px; font-size: 18px; font-weight: 600;">
                                    <i class="fab fa-android" style="color: #3ddc84;"></i> Android (Chrome/Edge)
                                </h4>
                                <ol style="margin-left: 20px; line-height: 2; color: var(--text-secondary); font-size: 16px;">
                                    <li style="margin-bottom: 12px;">Ανοίξτε το μενού του browser (τρεις τελείες <code style="background: var(--bg-card); padding: 2px 8px; border-radius: 4px;">⋮</code>)</li>
                                    <li style="margin-bottom: 12px;">Επιλέξτε <strong>"Add to Home screen"</strong> ή <strong>"Install app"</strong></li>
                                    <li style="margin-bottom: 12px;">Επιβεβαιώστε την εγκατάσταση</li>
                                    <li style="margin-bottom: 12px;">Η εφαρμογή θα εμφανιστεί στην αρχική οθόνη σας</li>
                                </ol>
                            </div>

                            <div style="margin-bottom: 24px; padding-top: 20px; border-top: 1px dashed var(--border);">
                                <h4 style="color: var(--primary); margin-bottom: 12px; font-size: 18px; font-weight: 600;">
                                    <i class="fab fa-apple" style="color: #000;"></i> iOS (Safari)
                                </h4>
                                <ol style="margin-left: 20px; line-height: 2; color: var(--text-secondary); font-size: 16px;">
                                    <li style="margin-bottom: 12px;">Πατήστε το κουμπί <strong>Share</strong> <code style="background: var(--bg-card); padding: 2px 8px; border-radius: 4px;">⬆️</code> (στο κάτω μέρος της οθόνης)</li>
                                    <li style="margin-bottom: 12px;">Κάντε scroll και επιλέξτε <strong>"Add to Home Screen"</strong></li>
                                    <li style="margin-bottom: 12px;">Πατήστε <strong>"Add"</strong> για επιβεβαίωση</li>
                                    <li style="margin-bottom: 12px;">Το εικονίδιο θα εμφανιστεί στην αρχική οθόνη</li>
                                </ol>
                            </div>

                            <div style="margin-bottom: 24px; padding-top: 20px; border-top: 1px dashed var(--border);">
                                <h4 style="color: var(--primary); margin-bottom: 12px; font-size: 18px; font-weight: 600;">
                                    <i class="fab fa-windows" style="color: #0078d4;"></i> Windows (Chrome/Edge)
                                </h4>
                                <ol style="margin-left: 20px; line-height: 2; color: var(--text-secondary); font-size: 16px;">
                                    <li style="margin-bottom: 12px;">Κάντε κλικ στο εικονίδιο εγκατάστασης <code style="background: var(--bg-card); padding: 2px 8px; border-radius: 4px;">⊕</code> στη γραμμή διευθύνσεων</li>
                                    <li style="margin-bottom: 12px;">Ή ανοίξτε το μενού <code style="background: var(--bg-card); padding: 2px 8px; border-radius: 4px;">⋮</code> → <strong>"Install ΑστυΝομικά"</strong></li>
                                    <li style="margin-bottom: 12px;">Επιβεβαιώστε την εγκατάσταση</li>
                                    <li style="margin-bottom: 12px;">Η εφαρμογή θα ανοίξει σε ξεχωριστό παράθυρο</li>
                                </ol>
                            </div>

                            <div style="background: var(--bg-card); padding: 20px; border-radius: var(--radius); border-left: 4px solid var(--success);">
                                <h4 style="color: var(--success); margin-bottom: 12px; font-size: 16px; font-weight: 600;">
                                    <i class="fas fa-check-circle"></i> Πλεονεκτήματα Εγκατάστασης
                                </h4>
                                <ul style="margin-left: 20px; line-height: 2; color: var(--text-secondary); font-size: 15px;">
                                    <li>🚀 Γρηγορότερη πρόσβαση από την αρχική οθόνη</li>
                                    <li>📱 Πλήρης οθόνη χωρίς την μπάρα του browser</li>
                                    <li>💾 Λειτουργία offline (όταν είστε εκτός σύνδεσης)</li>
                                    <li>🔔 Δυνατότητα ειδοποιήσεων (μελλοντικά)</li>
                                    <li>⚡ Καλύτερη απόδοση και ταχύτητα</li>
                                </ul>
                            </div>

                            <div style="background: linear-gradient(135deg, rgba(239, 71, 111, 0.1), rgba(251, 133, 0, 0.1)); padding: 20px; border-radius: var(--radius); border-left: 4px solid var(--danger); margin-top: 16px;">
                                <h4 style="color: var(--danger); margin-bottom: 12px; font-size: 16px; font-weight: 600;">
                                    <i class="fas fa-exclamation-triangle"></i> Σημαντικό: Απαιτήσεις Εγκατάστασης
                                </h4>
                                <ul style="margin-left: 20px; line-height: 2; color: var(--text-secondary); font-size: 15px;">
                                    <li><strong>Η εφαρμογή πρέπει να φορτωθεί μέσω HTTPS ή localhost</strong></li>
                                    <li>Αν ανοίξετε το αρχείο απευθείας (file://), η εγκατάσταση δεν θα είναι διαθέσιμη</li>
                                    <li><strong>Λύση:</strong> Ανεβάστε το αρχείο σε web server (π.χ. GitHub Pages, Netlify, Vercel)</li>
                                    <li>Ή χρησιμοποιήστε έναν τοπικό server (π.χ. Python: <code style="background: var(--bg-card); padding: 2px 6px; border-radius: 4px; font-family: monospace;">python -m http.server</code>)</li>
                                </ul>
                            </div>
                        </div>
                        <div style="background: linear-gradient(135deg, rgba(251, 133, 0, 0.05), rgba(239, 71, 111, 0.05)); padding: 32px; border-radius: var(--radius-lg); border: 1px solid var(--border); box-shadow: var(--shadow-md);">
                            <h3 style="color: var(--accent); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; font-size: 24px;">
                                <div style="width: 48px; height: 48px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                Σημαντικές Πληροφορίες
                            </h3>
                            <ul style="margin-left: 20px; line-height: 2; color: var(--text-secondary); font-size: 16px;">
                                <li style="margin-bottom: 12px; display: flex; align-items: start; gap: 12px;">
                                    <i class="fas fa-check-circle" style="color: var(--success); margin-top: 4px;"></i>
                                    <span>Το αρχείο JSON πρέπει να είναι σε έγκυρη μορφή</span>
                                </li>
                                <li style="margin-bottom: 12px; display: flex; align-items: start; gap: 12px;">
                                    <i class="fas fa-check-circle" style="color: var(--success); margin-top: 4px;"></i>
                                    <span>Συνιστάται η τακτική δημιουργία αντιγράφων ασφαλείας</span>
                                </li>
                                <li style="margin-bottom: 12px; display: flex; align-items: start; gap: 12px;">
                                    <i class="fas fa-check-circle" style="color: var(--success); margin-top: 4px;"></i>
                                    <span>Τα δεδομένα αποθηκεύονται <strong>τοπικά</strong> στον browser σας (Local Storage)</span>
                                </li>
                                <li style="margin-bottom: 12px; display: flex; align-items: start; gap: 12px;">
                                    <i class="fas fa-check-circle" style="color: var(--success); margin-top: 4px;"></i>
                                    <span>Για μεταφορά σε άλλη συσκευή: εξάγετε → εισάγετε το JSON αρχείο</span>
                                </li>
                                <li style="margin-bottom: 12px; display: flex; align-items: start; gap: 12px;">
                                    <i class="fas fa-exclamation-triangle" style="color: var(--danger); margin-top: 4px;"></i>
                                    <span><strong>Μην διαγράψετε</strong> το browser cache χωρίς πρώτα να εξάγετε τα δεδομένα!</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- CONTACT VIEW -->
                <div id="contactView" class="view-content" style="display: none;">
                    <div style="max-width: 800px; margin: 0 auto;">
                        <h2 style="margin-bottom: 32px; font-size: 32px; font-weight: 700; display: flex; align-items: center; gap: 16px;">
                            <i class="fas fa-envelope" style="color: var(--accent);"></i>
                            Επικοινωνία & Υποστήριξη
                        </h2>
                        
                        <div style="background: linear-gradient(135deg, rgba(10, 36, 99, 0.08), rgba(251, 133, 0, 0.08)); padding: 48px; border-radius: var(--radius-xl); border: 2px solid var(--border); box-shadow: var(--shadow-lg);">
                            <div style="text-align: center; margin-bottom: 40px;">
                                <div style="width: 96px; height: 96px; background: linear-gradient(135deg, var(--accent), var(--accent-light)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; box-shadow: var(--shadow-lg); margin: 0 auto 24px;">
                                    <i class="fas fa-envelope"></i>
                                </div>
                                <h3 style="color: var(--primary); margin-bottom: 16px; font-size: 28px; font-weight: 700;">Επικοινωνήστε μαζί μας</h3>
                                <a href="/cdn-cgi/l/email-protection#cfaebcbbb6a1a0a2a6a4ae8fa8a2aea6a3e1aca0a2" style="color: var(--accent); text-decoration: none; font-size: 24px; font-weight: 600; display: inline-flex; align-items: center; gap: 12px; transition: all var(--transition); padding: 16px 32px; background: var(--bg-card); border-radius: var(--radius-lg); box-shadow: var(--shadow-md);" onmouseover="this.style.transform='translateY(-4px) scale(1.05)'; this.style.boxShadow='var(--shadow-lg)';" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='var(--shadow-md)';">
                                    <i class="fas fa-paper-plane"></i>
                                    <span><span class="__cf_email__" data-cfemail="a3c2d0d7dacdcccecac8c2e3c4cec2cacf8dc0ccce">[email&#160;protected]</span></span>
                                </a>
                            </div>
                            
                            <div style="background: var(--bg-card); padding: 32px; border-radius: var(--radius-lg); border: 1px solid var(--border); box-shadow: var(--shadow);">
                                <div style="margin-bottom: 24px;">
                                    <h4 style="color: var(--primary); margin-bottom: 12px; font-size: 20px; display: flex; align-items: center; gap: 12px;">
                                        <i class="fas fa-question-circle" style="color: var(--info);"></i>
                                        Πότε να επικοινωνήσετε
                                    </h4>
                                    <ul style="margin-left: 40px; line-height: 2; color: var(--text-secondary); font-size: 16px;">
                                        <li>Για οποιαδήποτε απορία σχετικά με τη χρήση της εφαρμογής</li>
                                        <li>Για αναφορά προβλημάτων ή σφαλμάτων (bugs)</li>
                                        <li>Για προτάσεις νέων λειτουργιών</li>
                                        <li>Για τεχνική υποστήριξη</li>
                                    </ul>
                                </div>

                                <div style="border-top: 1px solid var(--border); padding-top: 24px;">
                                    <h4 style="color: var(--success); margin-bottom: 12px; font-size: 20px; display: flex; align-items: center; gap: 12px;">
                                        <i class="fas fa-heart" style="color: var(--danger);"></i>
                                        Η γνώμη σας μας ενδιαφέρει!
                                    </h4>
                                    <p style="color: var(--text-secondary); line-height: 1.8; font-size: 16px;">
                                        Θα χαρούμε να ακούσουμε τις ιδέες σας για βελτίωση της εφαρμογής. 
                                        Κάθε feedback είναι πολύτιμο και μας βοηθά να κάνουμε το σύστημα καλύτερο για όλους!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <!-- ========================================
         ADD/EDIT MODAL
    ======================================== -->
    <div class="modal" id="addEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Νέα Νομοθεσία</h2>
                <button class="modal-close" onclick="closeModal()" aria-label="Κλείσιμο">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="legislationForm">
                    <div class="form-group">
                        <label class="form-label" for="legislationType">Τύπος Νομοθεσίας *</label>
                        <select class="form-select" id="legislationType" required>
                            <option value="">Επιλέξτε τύπο</option>
                            <option value="law">Νόμος</option>
                            <option value="decree">Διάταγμα</option>
                            <option value="circular">Εγκύκλιος</option>
                            <option value="decision">Απόφαση</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="legislationNumber">Αριθμός *</label>
                        <input type="text" class="form-input" id="legislationNumber" placeholder="π.χ. 4611/2019" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="legislationTitle">Τίτλος *</label>
                        <input type="text" class="form-input" id="legislationTitle" placeholder="Εισάγετε τον τίτλο" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="legislationCategory">Κατηγορία *</label>
                        <select class="form-select" id="legislationCategory" required>
                            <option value="">Επιλέξτε κατηγορία</option>
                            <option value="Ποινικό Δίκαιο">Ποινικό Δίκαιο</option>
                            <option value="Διοικητικό">Διοικητικό</option>
                            <option value="Τροχαία">Τροχαία</option>
                            <option value="Όπλα">Όπλα</option>
                            <option value="Ναρκωτικά">Ναρκωτικά</option>
                            <option value="Μετανάστευση">Μετανάστευση</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="legislationDate">Ημερομηνία Έκδοσης</label>
                        <input type="date" class="form-input" id="legislationDate">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label class="form-label" for="legislationFekNumber">Αριθμός ΦΕΚ</label>
                            <input type="text" class="form-input" id="legislationFekNumber" placeholder="π.χ. 75">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="legislationFekIssue">Φύλλο ΦΕΚ</label>
                            <select class="form-select" id="legislationFekIssue">
                                <option value="">Επιλέξτε φύλλο</option>
                                <option value="Α">Α' - Νόμοι</option>
                                <option value="Β">Β' - Διατάγματα & Αποφάσεις</option>
                                <option value="Γ">Γ' - Διορισμοί & Τοποθετήσεις</option>
                                <option value="Δ">Δ' - Διάφορα</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="legislationUrl">Υπερσύνδεσμος (URL)</label>
                        <input type="url" class="form-input" id="legislationUrl" placeholder="https://...">
                    </div>

                    <!-- ΤΡΟΠΟΠΟΙΗΜΕΝΟ: Συσχετιζόμενες Νομοθεσίες με αναζήτηση -->
                    <div class="form-group">
                        <label class="form-label" for="legislationRelated">
                            <i class="fas fa-link"></i> Συσχετιζόμενες Νομοθεσίες
                        </label>
                        <div id="legislationRelated">
                            <!-- Will be populated dynamically with search functionality -->
                        </div>
                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                            Αναζητήστε και επιλέξτε συσχετιζόμενες νομοθεσίες από τη βάση δεδομένων
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="legislationTags">Ετικέτες (Tags)</label>
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <input type="text" class="form-input" id="legislationTagInput" placeholder="Προσθήκη ετικέτας..." style="flex: 1;">
                            <button type="button" class="action-btn btn-primary" onclick="addTagToForm()" style="padding: 8px 16px;">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div id="legislationTagsDisplay" style="display: flex; flex-wrap: wrap; gap: 8px; min-height: 40px; padding: 8px; background: var(--bg-main); border-radius: var(--radius); border: 1px solid var(--border);">
                            <!-- Tags will appear here -->
                        </div>
                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                            Πατήστε Enter ή + για προσθήκη
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="legislationDeadline">
                            <i class="fas fa-bell"></i> Προθεσμία / Υπενθύμιση
                        </label>
                        <input type="date" class="form-input" id="legislationDeadline" placeholder="Επιλέξτε ημερομηνία">
                        <small style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; display: block;">
                            Θα λάβετε ειδοποίηση όταν πλησιάζει η προθεσμία
                        </small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="legislationAttachments">
                            <i class="fas fa-paperclip"></i> Συνημμένα Αρχεία
                        </label>
                        <div style="border: 2px dashed var(--border); border-radius: var(--radius); padding: 20px; text-align: center; background: var(--bg-main); transition: all var(--transition); cursor: pointer;" id="attachmentDropZone" onclick="document.getElementById('fileInput').click()">
                            <input type="file" id="fileInput" multiple style="display: none;" accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png,.txt">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 32px; color: var(--accent); margin-bottom: 8px;"></i>
                            <p style="margin: 8px 0; font-weight: 600;">Κλικ για επιλογή αρχείων</p>
                            <p style="color: var(--text-secondary); font-size: 13px; margin: 0;">ή σύρετε αρχεία εδώ (PDF, Word, Excel, Images)</p>
                        </div>
                        <div id="attachmentsList" style="margin-top: 12px;"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="legislationNotes">Προσωπικές Σημειώσεις</label>
                        <textarea class="form-textarea" id="legislationNotes" rows="4" placeholder="Προσθέστε τις σημειώσεις σας εδώ..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Περιεχόμενο</label>
                        <div class="editor-container">
                            <div id="legislationEditor"></div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 32px;">
                        <button type="button" class="action-btn" style="background: var(--border); color: var(--text-primary);" onclick="closeModal()">
                            <span>Ακύρωση</span>
                        </button>
                        <button type="submit" class="action-btn btn-primary">
                            <i class="fas fa-save"></i>
                            <span>Αποθήκευση</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ========================================
         VIEW MODAL
    ======================================== -->
    <div class="modal" id="viewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="viewModalTitle"></h2>
                <div style="display: flex; gap: 8px;">
                    <button class="header-btn" id="favoriteBtn" onclick="toggleFavorite()" title="Αγαπημένο" aria-label="Προσθήκη/Αφαίρεση από αγαπημένα">
                        <i class="far fa-heart"></i>
                    </button>
                    <button class="header-btn" onclick="printLegislation()" title="Εκτύπωση" aria-label="Εκτύπωση">
                        <i class="fas fa-print"></i>
                    </button>
                    <button class="header-btn" onclick="editCurrentLegislation()" title="Επεξεργασία" aria-label="Επεξεργασία">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="header-btn" onclick="deleteCurrentLegislation()" title="Διαγραφή" aria-label="Διαγραφή">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="modal-close" onclick="closeViewModal()" aria-label="Κλείσιμο">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="modal-body">
                <!-- Search in text -->
                <div style="margin-bottom: 24px;">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input 
                            type="text" 
                            class="search-input" 
                            id="searchInText" 
                            placeholder="Αναζήτηση στο κείμενο..."
                            aria-label="Αναζήτηση στο κείμενο"
                        >
                        <button class="clear-search" id="clearTextSearch" onclick="clearTextSearch()" aria-label="Καθαρισμός αναζήτησης">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div id="searchResultsInfo" style="display: none; margin-top: 8px; font-size: 13px;"></div>
                </div>

                <div style="margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid var(--border);" class="dark-mode-border">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div>
                            <strong style="color: var(--text-secondary); font-size: 13px;">Αριθμός:</strong>
                            <div id="viewNumber" style="margin-top: 4px;"></div>
                        </div>
                        <div>
                            <strong style="color: var(--text-secondary); font-size: 13px;">Κατηγορία:</strong>
                            <div id="viewCategory" style="margin-top: 4px;"></div>
                        </div>
                        <div>
                            <strong style="color: var(--text-secondary); font-size: 13px;">Ημερομηνία:</strong>
                            <div id="viewDate" style="margin-top: 4px;"></div>
                        </div>
                        <div id="viewFekContainer" style="display: none;">
                            <strong style="color: var(--text-secondary); font-size: 13px;">ΦΕΚ:</strong>
                            <div id="viewFek" style="margin-top: 4px;"></div>
                        </div>
                        <div id="viewUrlContainer" style="display: none;">
                            <strong style="color: var(--text-secondary); font-size: 13px;">Σύνδεσμος:</strong>
                            <div id="viewUrl" style="margin-top: 4px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Related legislation -->
                <div id="relatedLegislationContainer" style="display: none; margin-bottom: 24px; padding: 16px; background: var(--bg-main); border-radius: var(--radius); border: 1px solid var(--border);" class="dark-mode-bg dark-mode-border">
                    <h4 style="margin-bottom: 12px; font-size: 14px; font-weight: 600;">
                        <i class="fas fa-link"></i> Συσχετιζόμενες Νομοθεσίες
                    </h4>
                    <div id="relatedLegislationList"></div>
                </div>

                <!-- Tags -->
                <div id="viewTagsContainer" style="display: none; margin-bottom: 24px; padding: 16px; background: var(--bg-main); border-radius: var(--radius); border: 1px solid var(--border);" class="dark-mode-bg dark-mode-border">
                    <h4 style="margin-bottom: 12px; font-size: 14px; font-weight: 600;">
                        <i class="fas fa-tags"></i> Ετικέτες
                    </h4>
                    <div id="viewTagsList" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                </div>

                <!-- Notes -->
                <div id="viewNotesContainer" style="display: none; margin-bottom: 24px; padding: 16px; background: var(--bg-main); border-radius: var(--radius); border: 1px solid var(--border);" class="dark-mode-bg dark-mode-border">
                    <h4 style="margin-bottom: 12px; font-size: 14px; font-weight: 600;">
                        <i class="fas fa-sticky-note"></i> Προσωπικές Σημειώσεις
                    </h4>
                    <div id="viewNotesText" style="white-space: pre-wrap; line-height: 1.6; color: var(--text-primary);"></div>
                </div>

                <!-- Attachments - ΤΡΟΠΟΠΟΙΗΜΕΝΟ -->
                <div id="viewAttachmentsContainer" style="display: none; margin-bottom: 24px; padding: 16px; background: var(--bg-main); border-radius: var(--radius); border: 1px solid var(--border);" class="dark-mode-bg dark-mode-border">
                    <!-- Content will be populated dynamically -->
                </div>

                <!-- Edit History -->
                <div id="viewHistoryContainer" style="display: none; margin-bottom: 24px; padding: 16px; background: var(--bg-main); border-radius: var(--radius); border: 1px solid var(--border);" class="dark-mode-bg dark-mode-border">
                    <h4 style="margin-bottom: 12px; font-size: 14px; font-weight: 600;">
                        <i class="fas fa-history"></i> Ιστορικό Τροποποιήσεων
                    </h4>
                    <div id="viewHistoryList"></div>
                </div>

                <div id="viewContent" class="legislation-content"></div>
            </div>
        </div>
    </div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ===================================
        // GLOBAL VARIABLES
        // ===================================
        let legislationData = [];
        let currentLegislationId = null;
        let quillEditor = null;
        let categoryChart = null;
        let typeChart = null;
        let timelineChart = null;
        let searchResults = [];
        let currentResultIndex = -1;
        let currentViewMode = 'grid';
        let currentTags = [];
        let currentAttachments = [];
        let selectedRelatedIds = [];
        
        // Custom types and categories
        let customLegislationTypes = {
            'law': 'Νόμος',
            'decree': 'Διάταγμα',
            'circular': 'Εγκύκλιος',
            'decision': 'Απόφαση'
        };
        
        let customCategories = [
            'Ποινικό Δίκαιο',
            'Διοικητικό',
            'Τροχαία',
            'Όπλα',
            'Ναρκωτικά',
            'Μετανάστευση'
        ];

        // ===================================
        // INITIALIZATION
        // ===================================
        document.addEventListener('DOMContentLoaded', async function() {
            initializeApp();
            await loadData();
            loadCustomTypesAndCategories();
            initializeQuill();
            updateDashboard();
            renderLegislationList();
            
            // Event Listeners
            document.getElementById('searchInput').addEventListener('input', debounce(handleSearch, 300));
            document.getElementById('legislationForm').addEventListener('submit', handleFormSubmit);
            
            const searchInText = document.getElementById('searchInText');
            if (searchInText) {
                searchInText.addEventListener('input', debounce(searchInLegislationText, 300));
                searchInText.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        navigateSearchResults(1);
                    }
                });
            }
            
            // Color theme listeners
            document.querySelectorAll('input[name="colorTheme"]').forEach(radio => {
                radio.addEventListener('change', applyColorTheme);
            });
            
            // Load theme preference
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                const themeIcon = document.getElementById('themeIcon');
                if (themeIcon) themeIcon.className = 'fas fa-sun';
                const darkModeToggle = document.getElementById('darkModeToggle');
                if (darkModeToggle) darkModeToggle.checked = true;
            }
            
            // Load color theme
            const savedColorTheme = localStorage.getItem('colorTheme') || 'blue';
            const themeRadio = document.getElementById('theme' + savedColorTheme.charAt(0).toUpperCase() + savedColorTheme.slice(1));
            if (themeRadio) {
                themeRadio.checked = true;
            }
            applyColorTheme();
            
            // Load view mode preference
            currentViewMode = localStorage.getItem('viewMode') || 'grid';
            updateViewModeButtons();
            
            // Initialize file attachments
            setTimeout(() => {
                handleFileInput();
                setupDragDrop();
                checkDeadlines();
                
                // Check deadlines every hour
                setInterval(checkDeadlines, 60 * 60 * 1000);
            }, 1000);
            
            // Setup modal click outside
            setupModalClickOutside();
            
            // Setup tag input enter key
            const tagInput = document.getElementById('legislationTagInput');
            if (tagInput) {
                tagInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addTagToForm();
                    }
                });
            }
        });

        function initializeApp() {
            console.log('🚀 Εφαρμογή ΑστυΝομικά ξεκίνησε επιτυχώς!');
        }

        function initializeQuill() {
            if (!Quill) {
                console.error('Quill library not loaded');
                return;
            }
            
            try {
                const Font = Quill.import('formats/font');
                Font.whitelist = ['sans-serif', 'arial', 'times-new-roman', 'georgia', 'courier', 'roboto', 'open-sans', 'lato', 'montserrat', 'merriweather'];
                Quill.register(Font, true);

                const toolbarOptions = [
                    [{ 'header': [1, 2, 3, 4, 5, 6, false] }],
                    [{ 'font': Font.whitelist }],
                    [{ 'size': ['small', false, 'large', 'huge'] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'script': 'sub'}, { 'script': 'super' }],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    [{ 'indent': '-1'}, { 'indent': '+1' }],
                    [{ 'align': [] }],
                    ['blockquote', 'code-block'],
                    ['link', 'image'],
                    ['clean']
                ];

                const modules = {
                    toolbar: toolbarOptions
                };

                const editorElement = document.getElementById('legislationEditor');
                if (editorElement) {
                    quillEditor = new Quill(editorElement, {
                        theme: 'snow',
                        modules: modules,
                        placeholder: 'Εισάγετε το περιεχόμενο της νομοθεσίας...'
                    });
                    
                    quillEditor.on('text-change', function() {
                        clearTimeout(window.quillSaveTimeout);
                        window.quillSaveTimeout = setTimeout(function() {
                            if (currentLegislationId) {
                                const tempContent = quillEditor.root.innerHTML;
                                sessionStorage.setItem('quill_temp_' + currentLegislationId, tempContent);
                            }
                        }, 2000);
                    });
                }
            } catch (error) {
                console.error('Error initializing Quill:', error);
            }
        }

        // ===================================
        // DATA MANAGEMENT
        // ===================================
        async function loadData() {
            try {
                const saved = localStorage.getItem('legislationData');
                if (saved) {
                    try {
                        legislationData = JSON.parse(saved);
                        console.log(`✅ Φορτώθηκαν ${legislationData.length} νομοθεσίες από το localStorage`);
                    } catch (e) {
                        console.error('Parse error:', e);
                        legislationData = [];
                    }
                } else {
                    legislationData = [
                        {
                            id: 1,
                            type: 'law',
                            number: '4611/2019',
                            title: 'Ενιαίος Κώδικας Πολιτικής Δικονομίας',
                            category: 'Ποινικό Δίκαιο',
                            date: '2019-05-30',
                            fekNumber: '75',
                            fekIssue: 'Α',
                            url: '',
                            relatedIds: [],
                            content: '<p>Περιεχόμενο νομοθεσίας...</p>',
                            createdAt: new Date().toISOString(),
                            tags: [],
                            notes: '',
                            editHistory: [],
                            attachments: []
                        }
                    ];
                    await saveData();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                legislationData = [];
            }
        }

        async function saveData() {
            try {
                const dataToSave = legislationData.map(item => {
                    return { ...item };
                });
                
                localStorage.setItem('legislationData', JSON.stringify(dataToSave));
                console.log(`✅ Αποθηκεύτηκαν ${dataToSave.length} νομοθεσίες`);
                updateDashboard();
                renderLegislationList();
                return true;
            } catch (error) {
                console.error('Error saving data:', error);
                if (error.name === 'QuotaExceededError') {
                    showToast('Το αρχείο είναι πολύ μεγάλο για αποθήκευση. Κάντε εξαγωγή σε JSON.', 'error');
                    await cleanupLargeData();
                } else {
                    showToast('Σφάλμα κατά την αποθήκευση: ' + error.message, 'error');
                }
                return false;
            }
        }

        async function cleanupLargeData() {
            legislationData = legislationData.map(item => {
                const itemCopy = { ...item };
                if (itemCopy.attachments && itemCopy.attachments.length > 0) {
                    showToast(`⚠️ Τα συνημμένα από "${itemCopy.title}" αφαιρέθηκαν λόγω μεγέθους`, 'warning');
                    itemCopy.attachments = [];
                }
                return itemCopy;
            });
            
            await saveData();
        }

        function loadCustomTypesAndCategories() {
            const savedTypes = localStorage.getItem('customLegislationTypes');
            if (savedTypes) {
                customLegislationTypes = JSON.parse(savedTypes);
            }
            
            const savedCategories = localStorage.getItem('customCategories');
            if (savedCategories) {
                customCategories = JSON.parse(savedCategories);
            }
            
            updateTypesList();
            updateCategoriesList();
        }

        function saveCustomTypesAndCategories() {
            localStorage.setItem('customLegislationTypes', JSON.stringify(customLegislationTypes));
            localStorage.setItem('customCategories', JSON.stringify(customCategories));
        }

        // ===================================
        // VIEW MODE TOGGLE
        // ===================================
        function toggleViewMode(mode, containerId = 'legislationGrid') {
            currentViewMode = mode;
            localStorage.setItem('viewMode', mode);
            
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (mode === 'list') {
                container.classList.add('list-view');
            } else {
                container.classList.remove('list-view');
            }
            
            updateViewModeButtons(containerId);
        }

        function updateViewModeButtons(containerId = 'legislationGrid') {
            let gridBtn, listBtn;
            if (containerId === 'recentLegislation') {
                gridBtn = document.getElementById('gridViewBtnDashboard');
                listBtn = document.getElementById('listViewBtnDashboard');
            } else {
                gridBtn = document.getElementById('gridViewBtn');
                listBtn = document.getElementById('listViewBtn');
            }
            
            if (!gridBtn || !listBtn) return;
            
            if (currentViewMode === 'grid') {
                gridBtn.classList.add('active');
                listBtn.classList.remove('active');
            } else {
                gridBtn.classList.remove('active');
                listBtn.classList.add('active');
            }
        }

        // ===================================
        // VIEW MANAGEMENT
        // ===================================
        function showView(viewName) {
            document.querySelectorAll('.view-content').forEach(view => {
                view.style.display = 'none';
            });
            
            const viewMap = {
                'dashboard': 'dashboardView',
                'legislation': 'legislationView',
                'search': 'legislationView',
                'statistics': 'statisticsView',
                'settings': 'settingsView',
                'instructions': 'instructionsView',
                'contact': 'contactView'
            };
            
            const viewId = viewMap[viewName];
            if (viewId) {
                document.getElementById(viewId).style.display = 'block';
            }
            
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.dataset.view === viewName) {
                    link.classList.add('active');
                }
            });
            
            if (viewName === 'statistics') {
                updateStatistics();
            } else if (viewName === 'settings') {
                updateTypesList();
                updateCategoriesList();
            }
            
            // Δεν έχουμε πλέον event εδώ, απλά κάνουμε return false από τα onclick
            return false;
        }

        // ===================================
        // DASHBOARD
        // ===================================
        function updateDashboard() {
            const totalLegislation = document.getElementById('totalLegislation');
            const totalCategories = document.getElementById('totalCategories');
            const totalTags = document.getElementById('totalTags');
            const favoritesCount = document.getElementById('favoritesCount');
            
            if (totalLegislation) totalLegislation.textContent = legislationData.length;
            
            const categories = [...new Set(legislationData.map(item => item.category))];
            if (totalCategories) totalCategories.textContent = categories.length;
            
            const allTags = new Set();
            legislationData.forEach(item => {
                if (item.tags && Array.isArray(item.tags)) {
                    item.tags.forEach(tag => allTags.add(tag));
                }
            });
            if (totalTags) totalTags.textContent = allTags.size;
            
            const favoritesCountValue = legislationData.filter(item => item.isFavorite).length;
            if (favoritesCount) favoritesCount.textContent = favoritesCountValue;
            
            const categoryFilter = document.getElementById('categoryFilter');
            if (categoryFilter) {
                categoryFilter.innerHTML = '<option value="">Όλες οι Κατηγορίες</option>';
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    categoryFilter.appendChild(option);
                });
            }
            
            const recentData = [...legislationData]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 6);
            
            renderLegislationCards(recentData, 'recentLegislation');
            
            const recentContainer = document.getElementById('recentLegislation');
            if (recentContainer && currentViewMode === 'list') {
                recentContainer.classList.add('list-view');
            }
            
            updateCategoryChart();
        }

        function updateCategoryChart() {
            const ctx = document.getElementById('categoryChart');
            if (!ctx) return;
            
            const categories = {};
            legislationData.forEach(item => {
                categories[item.category] = (categories[item.category] || 0) + 1;
            });
            
            if (categoryChart) {
                categoryChart.destroy();
            }
            
            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: [
                            'rgba(251, 133, 0, 0.8)',
                            'rgba(10, 36, 99, 0.8)',
                            'rgba(6, 214, 160, 0.8)',
                            'rgba(17, 138, 178, 0.8)',
                            'rgba(239, 71, 111, 0.8)',
                            'rgba(162, 155, 254, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    family: "'IBM Plex Sans', sans-serif",
                                    size: 13
                                }
                            }
                        }
                    }
                }
            });
        }

        // ===================================
        // LEGISLATION RENDERING
        // ===================================
        function renderLegislationList() {
            renderLegislationCards(legislationData, 'legislationGrid');
            
            const container = document.getElementById('legislationGrid');
            if (container && currentViewMode === 'list') {
                container.classList.add('list-view');
            }
            
            const emptyState = document.getElementById('emptyState');
            if (legislationData.length === 0) {
                const gridContainer = document.getElementById('legislationGrid');
                if (gridContainer) gridContainer.style.display = 'none';
                if (emptyState) emptyState.style.display = 'block';
            } else {
                const gridContainer = document.getElementById('legislationGrid');
                if (gridContainer) gridContainer.style.display = 'grid';
                if (emptyState) emptyState.style.display = 'none';
            }
        }

        function renderLegislationCards(data, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (data.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = data.map(item => `
                <div class="legislation-card" onclick="viewLegislation(${item.id})">
                    <div class="card-header">
                        <span class="card-badge badge-${item.type}">
                            ${getTypeName(item.type)}
                        </span>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            ${item.isFavorite ? '<i class="fas fa-heart" style="color: var(--danger);" title="Αγαπημένο"></i>' : ''}
                            ${item.url ? '<i class="fas fa-link" style="color: var(--accent);" title="Έχει υπερσύνδεσμο"></i>' : ''}
                            ${item.attachments && item.attachments.length > 0 ? '<i class="fas fa-paperclip" style="color: var(--info);" title="Έχει συνημμένα"></i>' : ''}
                        </div>
                    </div>
                    <h3 class="card-title">${item.title}</h3>
                    <div class="card-number">${item.number}</div>
                    ${item.tags && item.tags.length > 0 ? `
                        <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 12px; margin-bottom: 8px;">
                            ${item.tags.slice(0, 3).map(tag => `
                                <span class="tag" onclick="event.stopPropagation(); showLegislationByTag('${tag}')" style="font-size: 11px; padding: 4px 10px;">${tag}</span>
                            `).join('')}
                            ${item.tags.length > 3 ? `<span class="tag" onclick="event.stopPropagation(); showAllTagsForLegislation(${item.id})" style="font-size: 11px; padding: 4px 10px;">+${item.tags.length - 3}</span>` : ''}
                        </div>
                    ` : ''}
                    <div class="card-meta">
                        <div class="card-meta-item">
                            <i class="fas fa-folder"></i>
                            <span>${item.category}</span>
                        </div>
                        <div class="card-meta-item">
                            <i class="fas fa-calendar"></i>
                            <span>${formatDate(item.date)}</span>
                        </div>
                        ${item.relatedIds && item.relatedIds.length > 0 ? `
                        <div class="card-meta-item">
                            <i class="fas fa-project-diagram"></i>
                            <span>${item.relatedIds.length} συσχ.</span>
                        </div>
                        ` : ''}
                        ${item.attachments && item.attachments.length > 0 ? `
                        <div class="card-meta-item">
                            <i class="fas fa-paperclip"></i>
                            <span>${item.attachments.length}</span>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function getTypeName(type) {
            return customLegislationTypes[type] || type;
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('el-GR');
            } catch (e) {
                return '-';
            }
        }

        // ===================================
        // SEARCH & FILTER
        // ===================================
        function handleSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const clearBtn = document.getElementById('clearSearch');
            
            if (searchTerm && clearBtn) {
                clearBtn.classList.add('visible');
            } else if (clearBtn) {
                clearBtn.classList.remove('visible');
            }
            
            filterLegislation();
        }

        function clearSearch() {
            const searchInput = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearSearch');
            if (searchInput) searchInput.value = '';
            if (clearBtn) clearBtn.classList.remove('visible');
            filterLegislation();
        }

        function filterLegislation() {
            const searchInput = document.getElementById('searchInput');
            const categoryFilter = document.getElementById('categoryFilter');
            
            if (!searchInput || !categoryFilter) return;
            
            const searchTerm = searchInput.value.toLowerCase();
            const categoryFilterValue = categoryFilter.value;
            
            let filtered = legislationData;
            
            if (searchTerm) {
                filtered = filtered.filter(item =>
                    (item.title && item.title.toLowerCase().includes(searchTerm)) ||
                    (item.number && item.number.toLowerCase().includes(searchTerm)) ||
                    (item.category && item.category.toLowerCase().includes(searchTerm))
                );
            }
            
            if (categoryFilterValue) {
                filtered = filtered.filter(item => item.category === categoryFilterValue);
            }
            
            sortLegislation(filtered);
        }

        function sortLegislation(dataToSort = null) {
            const sortSelect = document.getElementById('sortSelect');
            const sortValue = sortSelect?.value || 'newest';
            let data = dataToSort || legislationData;
            
            const sorted = [...data].sort((a, b) => {
                switch(sortValue) {
                    case 'newest':
                        return new Date(b.createdAt || b.date) - new Date(a.createdAt || a.date);
                    case 'oldest':
                        return new Date(a.createdAt || a.date) - new Date(b.createdAt || b.date);
                    case 'title_asc':
                        return (a.title || '').localeCompare(b.title || '', 'el');
                    case 'title_desc':
                        return (b.title || '').localeCompare(a.title || '', 'el');
                    default:
                        return 0;
                }
            });
            
            renderLegislationCards(sorted, 'legislationGrid');
        }

        // ===================================
        // MODAL MANAGEMENT
        // ===================================
        function openAddModal() {
            currentLegislationId = null;
            currentTags = [];
            currentAttachments = [];
            selectedRelatedIds = [];
            
            const modalTitle = document.getElementById('modalTitle');
            if (modalTitle) modalTitle.textContent = 'Νέα Νομοθεσία';
            
            const form = document.getElementById('legislationForm');
            if (form) form.reset();
            
            if (quillEditor) quillEditor.setContents([]);
            
            populateTypeSelect();
            populateCategorySelect();
            populateRelatedSelect();
            
            const modal = document.getElementById('addEditModal');
            if (modal) modal.classList.add('active');
            
            setTimeout(() => {
                renderTagsInForm();
                renderAttachments();
                const deadlineInput = document.getElementById('legislationDeadline');
                if (deadlineInput) deadlineInput.value = '';
                const notesInput = document.getElementById('legislationNotes');
                if (notesInput) notesInput.value = '';
                updateSelectedCount();
            }, 100);
        }

        function closeModal() {
            const modal = document.getElementById('addEditModal');
            if (modal) modal.classList.remove('active');
        }

        function populateTypeSelect() {
            const select = document.getElementById('legislationType');
            if (!select) return;
            
            select.innerHTML = '<option value="">Επιλέξτε τύπο</option>';
            
            Object.entries(customLegislationTypes).forEach(([key, value]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = value;
                select.appendChild(option);
            });
        }

        function populateCategorySelect() {
            const select = document.getElementById('legislationCategory');
            if (!select) return;
            
            select.innerHTML = '<option value="">Επιλέξτε κατηγορία</option>';
            
            customCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                select.appendChild(option);
            });
        }

        // ===================================
        // RELATED LEGISLATION - ENHANCED WITH SEARCH
        // ===================================
        function populateRelatedSelect(excludeId = null) {
            const container = document.getElementById('legislationRelated');
            if (!container) return;
            
            selectedRelatedIds = [];
            
            container.innerHTML = `
                <div style="border: 2px solid var(--border); border-radius: var(--radius); padding: 12px; background: var(--bg-main);">
                    <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                        <div class="search-box" style="flex: 1;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" 
                                   class="search-input" 
                                   id="relatedSearchInput" 
                                   placeholder="Αναζήτηση νομοθεσίας..."
                                   style="border: none; background: transparent; padding-left: 36px;">
                        </div>
                        <button type="button" class="action-btn btn-primary" onclick="selectAllRelated()" style="padding: 8px 12px;">
                            <i class="fas fa-check-double"></i>
                            <span>Όλα</span>
                        </button>
                        <button type="button" class="action-btn" onclick="deselectAllRelated()" style="padding: 8px 12px; background: var(--border); color: var(--text-primary);">
                            <i class="fas fa-times"></i>
                            <span>Καθαρισμός</span>
                        </button>
                    </div>
                    <div id="relatedLegislationOptions" 
                         style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 8px; background: var(--bg-card);">
                        <!-- Εδώ θα εμφανίζονται οι επιλογές -->
                    </div>
                    <div id="selectedRelatedCount" style="margin-top: 8px; font-size: 13px; color: var(--text-secondary);">
                        Επιλεγμένα: <span id="selectedCount">0</span>
                    </div>
                    <input type="hidden" id="selectedRelatedIds" value="">
                </div>
            `;
            
            renderRelatedOptions(excludeId);
            
            const searchInput = document.getElementById('relatedSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(function() {
                    filterRelatedOptions(this.value, excludeId);
                }, 300));
            }
            
            const item = legislationData.find(item => item.id === excludeId);
            if (item && item.relatedIds) {
                selectedRelatedIds = [...item.relatedIds];
                updateSelectedCount();
                
                setTimeout(() => {
                    selectedRelatedIds.forEach(id => {
                        const checkbox = document.querySelector(`input[type="checkbox"][value="${id}"]`);
                        if (checkbox) {
                            checkbox.checked = true;
                            const optionItem = checkbox.closest('.related-option-item');
                            if (optionItem) {
                                optionItem.classList.add('selected');
                                optionItem.style.background = 'rgba(251, 133, 0, 0.1)';
                                optionItem.style.borderColor = 'var(--accent)';
                            }
                        }
                    });
                }, 100);
            }
        }

        function renderRelatedOptions(excludeId = null, searchTerm = '') {
            const container = document.getElementById('relatedLegislationOptions');
            if (!container) return;
            
            const filtered = legislationData
                .filter(item => item.id !== excludeId)
                .filter(item => {
                    if (!searchTerm) return true;
                    const term = searchTerm.toLowerCase();
                    return (item.title && item.title.toLowerCase().includes(term)) || 
                           (item.number && item.number.toLowerCase().includes(term)) ||
                           (item.category && item.category.toLowerCase().includes(term));
                });
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 24px; color: var(--text-secondary);">
                        <i class="fas fa-search" style="font-size: 24px; margin-bottom: 8px; display: block;"></i>
                        ${searchTerm ? 'Δεν βρέθηκαν νομοθεσίες' : 'Δεν υπάρχουν διαθέσιμες νομοθεσίες'}
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(item => {
                const isSelected = selectedRelatedIds.includes(item.id);
                return `
                    <div class="related-option-item ${isSelected ? 'selected' : ''}" 
                         style="${isSelected ? 'background: rgba(251, 133, 0, 0.1); border-color: var(--accent);' : ''}">
                        <input type="checkbox" 
                               class="related-checkbox" 
                               value="${item.id}"
                               ${isSelected ? 'checked' : ''}
                               onchange="toggleRelatedSelection(${item.id}, this.checked)">
                        <div class="related-info">
                            <div class="related-number">${item.number}</div>
                            <div class="related-title">${item.title}</div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-top: 2px;">
                                <i class="fas fa-folder"></i> ${item.category} • 
                                <i class="fas fa-calendar"></i> ${formatDate(item.date)}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterRelatedOptions(searchTerm, excludeId = null) {
            renderRelatedOptions(excludeId, searchTerm);
        }

        function toggleRelatedSelection(id, isSelected) {
            const checkbox = document.querySelector(`input[value="${id}"]`);
            if (!checkbox) return;
            
            const optionItem = checkbox.closest('.related-option-item');
            
            if (isSelected) {
                if (!selectedRelatedIds.includes(id)) {
                    selectedRelatedIds.push(id);
                }
                if (optionItem) {
                    optionItem.classList.add('selected');
                    optionItem.style.background = 'rgba(251, 133, 0, 0.1)';
                    optionItem.style.borderColor = 'var(--accent)';
                }
            } else {
                selectedRelatedIds = selectedRelatedIds.filter(itemId => itemId !== id);
                if (optionItem) {
                    optionItem.classList.remove('selected');
                    optionItem.style.background = '';
                    optionItem.style.borderColor = '';
                }
            }
            
            updateSelectedCount();
        }

        function selectAllRelated() {
            const container = document.getElementById('relatedLegislationOptions');
            if (!container) return;
            
            const checkboxes = container.querySelectorAll('.related-checkbox');
            
            checkboxes.forEach(checkbox => {
                const id = parseInt(checkbox.value);
                if (!selectedRelatedIds.includes(id)) {
                    selectedRelatedIds.push(id);
                }
                checkbox.checked = true;
                const optionItem = checkbox.closest('.related-option-item');
                if (optionItem) {
                    optionItem.classList.add('selected');
                    optionItem.style.background = 'rgba(251, 133, 0, 0.1)';
                    optionItem.style.borderColor = 'var(--accent)';
                }
            });
            
            updateSelectedCount();
        }

        function deselectAllRelated() {
            const container = document.getElementById('relatedLegislationOptions');
            if (!container) return;
            
            const checkboxes = container.querySelectorAll('.related-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                const optionItem = checkbox.closest('.related-option-item');
                if (optionItem) {
                    optionItem.classList.remove('selected');
                    optionItem.style.background = '';
                    optionItem.style.borderColor = '';
                }
            });
            
            selectedRelatedIds = [];
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const countElement = document.getElementById('selectedCount');
            if (countElement) {
                countElement.textContent = selectedRelatedIds.length;
            }
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const relatedIds = [...selectedRelatedIds];
            
            const formData = {
                id: currentLegislationId || Date.now(),
                type: document.getElementById('legislationType').value,
                number: document.getElementById('legislationNumber').value,
                title: document.getElementById('legislationTitle').value,
                category: document.getElementById('legislationCategory').value,
                date: document.getElementById('legislationDate').value,
                fekNumber: document.getElementById('legislationFekNumber').value || '',
                fekIssue: document.getElementById('legislationFekIssue').value || '',
                url: document.getElementById('legislationUrl').value || '',
                relatedIds: relatedIds,
                content: quillEditor ? quillEditor.root.innerHTML : '',
                tags: [...currentTags],
                notes: document.getElementById('legislationNotes').value || '',
                deadline: document.getElementById('legislationDeadline').value || null,
                attachments: [...currentAttachments],
                editHistory: [],
                createdAt: currentLegislationId ? 
                    legislationData.find(item => item.id === currentLegislationId)?.createdAt || new Date().toISOString() : 
                    new Date().toISOString()
            };
            
            if (currentLegislationId) {
                const index = legislationData.findIndex(item => item.id === currentLegislationId);
                if (index !== -1) {
                    formData.editHistory = legislationData[index].editHistory || [];
                    formData.isFavorite = legislationData[index].isFavorite;
                    formData.editHistory.push({
                        timestamp: new Date().toISOString(),
                        description: 'Τροποποίηση νομοθεσίας'
                    });
                    if (formData.editHistory.length > 20) formData.editHistory = formData.editHistory.slice(-20);
                    legislationData[index] = formData;
                }
                showToast('Η νομοθεσία ενημερώθηκε επιτυχώς!', 'success');
            } else {
                formData.editHistory.push({
                    timestamp: new Date().toISOString(),
                    description: 'Δημιουργία νομοθεσίας'
                });
                legislationData.push(formData);
                showToast('Η νομοθεσία προστέθηκε επιτυχώς!', 'success');
            }
            
            await saveData();
            currentAttachments = [];
            currentTags = [];
            selectedRelatedIds = [];
            renderAttachments();
            renderTagsInForm();
            closeModal();
        }

        function viewLegislation(id) {
            const item = legislationData.find(item => item.id === id);
            if (!item) return;
            
            currentLegislationId = id;
            
            const viewModalTitle = document.getElementById('viewModalTitle');
            if (viewModalTitle) viewModalTitle.textContent = item.title;
            
            const viewNumber = document.getElementById('viewNumber');
            if (viewNumber) viewNumber.textContent = item.number;
            
            const viewCategory = document.getElementById('viewCategory');
            if (viewCategory) viewCategory.textContent = item.category;
            
            const viewDate = document.getElementById('viewDate');
            if (viewDate) viewDate.textContent = formatDate(item.date);
            
            // FEK
            const viewFekContainer = document.getElementById('viewFekContainer');
            const viewFek = document.getElementById('viewFek');
            if (item.fekNumber || item.fekIssue) {
                if (viewFekContainer) viewFekContainer.style.display = 'block';
                if (viewFek) viewFek.textContent = `${item.fekNumber || '-'}/${item.fekIssue || '-'}`;
            } else {
                if (viewFekContainer) viewFekContainer.style.display = 'none';
            }
            
            // URL
            const viewUrlContainer = document.getElementById('viewUrlContainer');
            const viewUrl = document.getElementById('viewUrl');
            if (item.url) {
                if (viewUrlContainer) viewUrlContainer.style.display = 'block';
                if (viewUrl) {
                    viewUrl.innerHTML = `
                        <a href="${item.url}" target="_blank" 
                           style="display: inline-flex; align-items: center; gap: 12px; padding: 12px 20px; 
                                  background: linear-gradient(135deg, var(--accent), var(--accent-light)); 
                                  color: white; text-decoration: none; border-radius: var(--radius); 
                                  font-weight: 600; transition: all var(--transition); box-shadow: var(--shadow);"
                           onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-md)';"
                           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow)';">
                            <i class="fas fa-external-link-alt" style="font-size: 20px;"></i>
                            <span>Άνοιγμα Συνδέσμου</span>
                        </a>`;
                }
            } else {
                if (viewUrlContainer) viewUrlContainer.style.display = 'none';
            }
            
            // Related legislation
            const relatedContainer = document.getElementById('relatedLegislationContainer');
            if (item.relatedIds && item.relatedIds.length > 0) {
                if (relatedContainer) relatedContainer.style.display = 'block';
                const relatedList = document.getElementById('relatedLegislationList');
                if (relatedList) {
                    const relatedHtml = item.relatedIds
                        .map(relId => {
                            const related = legislationData.find(l => l.id === relId);
                            if (!related) return '';
                            return `
                                <div style="padding: 16px 20px; 
                                            background: linear-gradient(135deg, rgba(10, 36, 99, 0.03), rgba(251, 133, 0, 0.03)); 
                                            border: 2px solid var(--border); 
                                            border-radius: var(--radius); 
                                            margin-bottom: 12px; 
                                            cursor: pointer; 
                                            transition: all var(--transition); 
                                            display: flex; 
                                            align-items: center; 
                                            gap: 16px;
                                            box-shadow: var(--shadow-sm);" 
                                     class="related-item dark-mode-bg dark-mode-border"
                                     onclick="event.stopPropagation(); closeViewModal(); setTimeout(() => viewLegislation(${related.id}), 300);">
                                    <div style="width: 40px; height: 40px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; flex-shrink: 0;">
                                        <i class="fas fa-link"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 700; color: var(--primary); margin-bottom: 4px; font-size: 15px;">${related.number}</div>
                                        <div style="font-size: 14px; color: var(--text-secondary); line-height: 1.4;">${related.title}</div>
                                    </div>
                                    <div style="width: 32px; height: 32px; background: var(--bg-main); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <i class="fas fa-arrow-right" style="color: var(--accent);"></i>
                                    </div>
                                </div>
                            `;
                        })
                        .join('');
                    relatedList.innerHTML = relatedHtml;
                    
                    const style = document.createElement('style');
                    style.textContent = `
                        .related-item:hover {
                            background: linear-gradient(135deg, rgba(10, 36, 99, 0.08), rgba(251, 133, 0, 0.08)) !important;
                            border-color: var(--accent) !important;
                            transform: translateX(8px) scale(1.03);
                            box-shadow: var(--shadow-lg);
                        }
                        .dark-mode .related-item:hover {
                            background: linear-gradient(135deg, rgba(10, 36, 99, 0.15), rgba(251, 133, 0, 0.15)) !important;
                        }
                    `;
                    if (!document.getElementById('related-item-hover-style')) {
                        style.id = 'related-item-hover-style';
                        document.head.appendChild(style);
                    }
                }
            } else {
                if (relatedContainer) relatedContainer.style.display = 'none';
            }
            
            // ΤΡΟΠΟΠΟΙΗΜΕΝΟ 3: Κάνε τα tags στη view modal clickable
            const viewTagsContainer = document.getElementById('viewTagsContainer');
            const viewTagsList = document.getElementById('viewTagsList');
            if (item.tags && item.tags.length > 0) {
                if (viewTagsContainer) viewTagsContainer.style.display = 'block';
                if (viewTagsList) {
                    viewTagsList.innerHTML = item.tags.map(tag => `
                        <span class="tag" onclick="showLegislationByTag('${tag}')">${tag}</span>
                    `).join('');
                }
            } else {
                if (viewTagsContainer) viewTagsContainer.style.display = 'none';
            }
            
            // Show notes
            const viewNotesContainer = document.getElementById('viewNotesContainer');
            const viewNotesText = document.getElementById('viewNotesText');
            if (item.notes && item.notes.trim()) {
                if (viewNotesContainer) viewNotesContainer.style.display = 'block';
                if (viewNotesText) viewNotesText.textContent = item.notes;
            } else {
                if (viewNotesContainer) viewNotesContainer.style.display = 'none';
            }
            
            // Show edit history
            const viewHistoryContainer = document.getElementById('viewHistoryContainer');
            const viewHistoryList = document.getElementById('viewHistoryList');
            if (item.editHistory && item.editHistory.length > 0) {
                if (viewHistoryContainer) viewHistoryContainer.style.display = 'block';
                if (viewHistoryList) {
                    viewHistoryList.innerHTML = item.editHistory
                        .slice().reverse()
                        .map(entry => `
                            <div style="padding: 8px; border-left: 3px solid var(--accent); margin-bottom: 8px; background: rgba(251, 133, 0, 0.05);">
                                <div style="font-size: 13px; color: var(--text-secondary);">
                                    ${formatDate(entry.timestamp)} ${new Date(entry.timestamp).toLocaleTimeString('el-GR', {hour: '2-digit', minute: '2-digit'})}
                                </div>
                                <div style="font-size: 14px; margin-top: 4px;">
                                    ${entry.description}
                                </div>
                            </div>
                        `).join('');
                }
            } else {
                if (viewHistoryContainer) viewHistoryContainer.style.display = 'none';
            }
            
            // Show deadline
            const deadlineContainer = document.getElementById('viewDeadlineContainer');
            if (item.deadline) {
                if (!deadlineContainer) {
                    const container = document.createElement('div');
                    container.id = 'viewDeadlineContainer';
                    container.style.cssText = 'display: block; margin-bottom: 24px; padding: 16px; background: var(--bg-main); border-radius: var(--radius); border: 1px solid var(--border);';
                    const relatedContainer = document.getElementById('relatedLegislationContainer');
                    if (relatedContainer) {
                        relatedContainer.parentNode.insertBefore(container, relatedContainer);
                    }
                }
                
                const status = getDeadlineStatus(item.deadline);
                const deadlineEl = document.getElementById('viewDeadlineContainer');
                if (deadlineEl) {
                    deadlineEl.innerHTML = `
                        <h4 style="margin-bottom: 12px; font-size: 14px; font-weight: 600;">
                            <i class="fas fa-bell"></i> Προθεσμία
                        </h4>
                        <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(${status.color === '#ef476f' ? '239, 71, 111' : status.color === '#fb8500' ? '251, 133, 0' : '17, 138, 178'}, 0.1); border-radius: var(--radius-sm); border-left: 4px solid ${status.color};">
                            <i class="fas fa-${status.icon}" style="color: ${status.color}; font-size: 20px;"></i>
                            <div>
                                <div style="font-weight: 600; font-size: 15px;">${formatDate(item.deadline)}</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">${status.text}</div>
                            </div>
                        </div>
                    `;
                }
            } else if (deadlineContainer) {
                deadlineContainer.remove();
            }
            
            // Show attachments
            const attachContainer = document.getElementById('viewAttachmentsContainer');
            if (item.attachments && item.attachments.length > 0) {
                if (!attachContainer) {
                    const container = document.createElement('div');
                    container.id = 'viewAttachmentsContainer';
                    container.style.cssText = 'display: block; margin-bottom: 24px; padding: 16px; background: var(--bg-main); border-radius: var(--radius); border: 1px solid var(--border);';
                    const deadlineEl = document.getElementById('viewDeadlineContainer');
                    const insertBefore = deadlineEl || document.getElementById('relatedLegislationContainer');
                    if (insertBefore) {
                        insertBefore.parentNode.insertBefore(container, insertBefore);
                    }
                }
                
                const attachmentsEl = document.getElementById('viewAttachmentsContainer');
                if (attachmentsEl) {
                    attachmentsEl.innerHTML = `
                        <h4 style="margin-bottom: 12px; font-size: 14px; font-weight: 600;">
                            <i class="fas fa-paperclip"></i> Συνημμένα Αρχεία (${item.attachments.length})
                        </h4>
                        ${item.attachments.map((att, index) => `
                            <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 8px;">
                                <div style="display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0;">
                                    <i class="fas fa-${getFileIcon(att.type)}" style="color: var(--accent); font-size: 18px;"></i>
                                    <div style="min-width: 0; flex: 1;">
                                        <div style="font-weight: 500; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${att.name}</div>
                                        <div style="font-size: 11px; color: var(--text-secondary);">${formatFileSize(att.size)} • ${new Date(att.uploadedAt).toLocaleDateString('el-GR')}</div>
                                    </div>
                                </div>
                                ${att.data ? `
                                    <button onclick="downloadAttachment(${id}, ${index})" 
                                            style="background: var(--accent); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; transition: all var(--transition);"
                                            onmouseover="this.style.transform='scale(1.05)';"
                                            onmouseout="this.style.transform='scale(1)';"
                                            title="Λήψη αρχείου">
                                        <i class="fas fa-download"></i> Λήψη
                                    </button>
                                ` : `
                                    <div style="font-size: 11px; color: var(--text-secondary);">Δεν διατίθεται</div>
                                `}
                            </div>
                        `).join('')}
                    `;
                }
            } else if (attachContainer) {
                attachContainer.remove();
            }
            
            const viewContent = document.getElementById('viewContent');
            if (viewContent) {
                viewContent.innerHTML = item.content || '<p>Δεν υπάρχει περιεχόμενο</p>';
            }
            
            // Clear search
            const searchInText = document.getElementById('searchInText');
            if (searchInText) searchInText.value = '';
            clearTextSearch();
            
            // Update favorite button
            updateFavoriteButton();
            
            const viewModal = document.getElementById('viewModal');
            if (viewModal) viewModal.classList.add('active');
        }

        function closeViewModal() {
            const viewModal = document.getElementById('viewModal');
            if (viewModal) viewModal.classList.remove('active');
            currentLegislationId = null;
            clearTextSearch();
        }

        function setupModalClickOutside() {
            const viewModal = document.getElementById('viewModal');
            if (viewModal) {
                viewModal.addEventListener('click', function(event) {
                    if (event.target.id === 'viewModal') {
                        closeViewModal();
                    }
                });
            }
            
            const addEditModal = document.getElementById('addEditModal');
            if (addEditModal) {
                addEditModal.addEventListener('click', function(event) {
                    if (event.target.id === 'addEditModal') {
                        closeModal();
                    }
                });
            }
        }

        function editCurrentLegislation() {
            if (!currentLegislationId) return;
            
            const item = legislationData.find(item => item.id === currentLegislationId);
            if (!item) return;
            
            closeViewModal();
            
            currentTags = item.tags || [];
            currentAttachments = item.attachments || [];
            selectedRelatedIds = item.relatedIds || [];
            
            const modalTitle = document.getElementById('modalTitle');
            if (modalTitle) modalTitle.textContent = 'Επεξεργασία Νομοθεσίας';
            
            populateTypeSelect();
            populateCategorySelect();
            populateRelatedSelect(item.id);
            
            const typeSelect = document.getElementById('legislationType');
            if (typeSelect) typeSelect.value = item.type || '';
            
            const numberInput = document.getElementById('legislationNumber');
            if (numberInput) numberInput.value = item.number || '';
            
            const titleInput = document.getElementById('legislationTitle');
            if (titleInput) titleInput.value = item.title || '';
            
            const categorySelect = document.getElementById('legislationCategory');
            if (categorySelect) categorySelect.value = item.category || '';
            
            const dateInput = document.getElementById('legislationDate');
            if (dateInput) dateInput.value = item.date || '';
            
            const fekNumberInput = document.getElementById('legislationFekNumber');
            if (fekNumberInput) fekNumberInput.value = item.fekNumber || '';
            
            const fekIssueSelect = document.getElementById('legislationFekIssue');
            if (fekIssueSelect) fekIssueSelect.value = item.fekIssue || '';
            
            const urlInput = document.getElementById('legislationUrl');
            if (urlInput) urlInput.value = item.url || '';
            
            const notesInput = document.getElementById('legislationNotes');
            if (notesInput) notesInput.value = item.notes || '';
            
            const deadlineInput = document.getElementById('legislationDeadline');
            if (deadlineInput) deadlineInput.value = item.deadline || '';
            
            if (quillEditor) {
                quillEditor.disable();
                quillEditor.root.innerHTML = '<div style="color: var(--text-secondary); text-align: center; padding: 30px; font-size: 16px;"><i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 10px;"></i><br>Φόρτωση κειμένου...</div>';
            }
            
            const modal = document.getElementById('addEditModal');
            if (modal) modal.classList.add('active');
            
            requestAnimationFrame(() => {
                setTimeout(() => {
                    if (quillEditor) {
                        const tempContent = sessionStorage.getItem('quill_temp_' + currentLegislationId);
                        if (tempContent) {
                            quillEditor.root.innerHTML = tempContent;
                            sessionStorage.removeItem('quill_temp_' + currentLegislationId);
                        } else {
                            quillEditor.root.innerHTML = item.content || '';
                        }
                        quillEditor.enable();
                    }
                    renderTagsInForm();
                    renderAttachments();
                    updateSelectedCount();
                }, 50);
            });
        }

        async function deleteCurrentLegislation() {
            if (!currentLegislationId) return;
            
            if (confirm('Είστε σίγουροι ότι θέλετε να διαγράψετε αυτή τη νομοθεσία;')) {
                legislationData = legislationData.filter(item => item.id !== currentLegislationId);
                await saveData();
                closeViewModal();
                showToast('Η νομοθεσία διαγράφηκε επιτυχώς', 'success');
            }
        }

        function printLegislation() {
            window.print();
        }

        // ===================================
        // ΤΡΟΠΟΠΟΙΗΜΕΝΗ ΛΕΙΤΟΥΡΓΙΑ: TAGS CLICKABLE
        // ===================================
        function showTagsList() {
            const allTags = new Set();
            legislationData.forEach(item => {
                if (item.tags && Array.isArray(item.tags)) {
                    item.tags.forEach(tag => allTags.add(tag));
                }
            });
            
            if (allTags.size === 0) {
                showToast('Δεν υπάρχουν ετικέτες διαθέσιμες', 'info');
                return;
            }
            
            const modalHTML = `
                <div style="background: var(--bg-card); border-radius: var(--radius-lg); padding: 32px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: var(--shadow-xl);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                        <h2 style="font-size: 24px; font-weight: 700;">
                            <i class="fas fa-tags" style="color: var(--accent); margin-right: 12px;"></i>
                            Όλες οι Ετικέτες (${allTags.size})
                        </h2>
                        <button onclick="closeTagsModal()" style="background: var(--border); border: none; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 32px;">
                        ${Array.from(allTags).map(tag => `
                            <span class="tag" onclick="showLegislationByTag('${tag}')" style="font-size: 14px; padding: 8px 16px; cursor: pointer;">
                                <i class="fas fa-hashtag" style="margin-right: 6px;"></i>
                                ${tag}
                            </span>
                        `).join('')}
                    </div>
                    <div style="border-top: 1px solid var(--border); padding-top: 24px;">
                        <h3 style="font-size: 18px; margin-bottom: 16px; color: var(--text-secondary);">
                            <i class="fas fa-info-circle" style="color: var(--info); margin-right: 8px;"></i>
                            Πληροφορίες
                        </h3>
                        <p style="color: var(--text-secondary); line-height: 1.6;">
                            Κάντε κλικ σε οποιαδήποτε ετικέτα για να δείτε όλες τις νομοθεσίες που έχουν αυτή την ετικέτα.
                        </p>
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.id = 'tagsModal';
            modal.style.cssText = 'position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 2000; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.3s ease-out;';
            modal.innerHTML = modalHTML;
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target.id === 'tagsModal') {
                    closeTagsModal();
                }
            });
            
            showToast(`Εμφάνιση ${allTags.size} ετικετών`, 'success');
        }

        function closeTagsModal() {
            const modal = document.getElementById('tagsModal');
            if (modal) {
                modal.remove();
            }
        }

        function showLegislationByTag(tag) {
            closeTagsModal();
            closeViewModal();
            
            const filtered = legislationData.filter(item => 
                item.tags && item.tags.includes(tag)
            );
            
            if (filtered.length === 0) {
                showToast(`Δεν βρέθηκαν νομοθεσίες με την ετικέτα "${tag}"`, 'info');
                return;
            }
            
            showView('legislation');
            
            const container = document.getElementById('legislationGrid');
            if (container) {
                renderLegislationCards(filtered, 'legislationGrid');
            }
            
            const searchBar = document.querySelector('.search-filter-bar');
            if (!searchBar) return;
            
            const customHeader = document.createElement('div');
            customHeader.style.cssText = 'background: linear-gradient(135deg, rgba(251, 133, 0, 0.1), rgba(251, 133, 0, 0.05)); padding: 16px 24px; border-radius: var(--radius); border: 2px solid var(--accent); margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center;';
            customHeader.innerHTML = `
                <div>
                    <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">
                        <i class="fas fa-hashtag" style="color: var(--accent); margin-right: 8px;"></i>
                        Ετικέτα: <span style="color: var(--accent);">"${tag}"</span>
                    </h3>
                    <p style="color: var(--text-secondary); font-size: 14px;">
                        Βρέθηκαν <strong>${filtered.length}</strong> νομοθεσίες
                    </p>
                </div>
                <button onclick="clearTagFilter()" style="background: var(--border); border: none; padding: 8px 16px; border-radius: var(--radius-sm); cursor: pointer; color: var(--text-primary); font-weight: 500; transition: all var(--transition);" onmouseover="this.style.background='var(--accent)'; this.style.color='white';">
                    <i class="fas fa-times"></i> Καθαρισμός
                </button>
            `;
            
            customHeader.id = 'tagFilterHeader';
            searchBar.parentNode.insertBefore(customHeader, searchBar.nextSibling);
            
            showToast(`Εμφάνιση ${filtered.length} νομοθεσιών με ετικέτα "${tag}"`, 'success');
        }

        function clearTagFilter() {
            const header = document.getElementById('tagFilterHeader');
            if (header) {
                header.remove();
            }
            renderLegislationList();
            showToast('Το φίλτρο ετικέτας καθαρίστηκε', 'info');
        }

        function showAllTagsForLegislation(id) {
            const item = legislationData.find(item => item.id === id);
            if (!item || !item.tags || item.tags.length <= 3) return;
            
            const modalHTML = `
                <div style="background: var(--bg-card); border-radius: var(--radius-lg); padding: 24px; max-width: 400px; width: 90%; max-height: 60vh; overflow-y: auto; box-shadow: var(--shadow-xl);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h3 style="font-size: 18px; font-weight: 700;">
                            <i class="fas fa-tags" style="color: var(--accent); margin-right: 8px;"></i>
                            Όλες οι ετικέτες
                        </h3>
                        <button onclick="closeAllTagsModal()" style="background: var(--border); border: none; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        ${item.tags.map(tag => `
                            <span class="tag" onclick="showLegislationByTag('${tag}')" style="font-size: 13px; padding: 6px 12px; cursor: pointer;">
                                ${tag}
                            </span>
                        `).join('')}
                    </div>
                    <div style="margin-top: 16px; font-size: 13px; color: var(--text-secondary); text-align: center;">
                        Κάντε κλικ σε οποιαδήποτε ετικέτα για αναζήτηση
                    </div>
                </div>
            `;
            
            const modal = document.createElement('div');
            modal.id = 'allTagsModal';
            modal.style.cssText = 'position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 2000; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.3s ease-out;';
            modal.innerHTML = modalHTML;
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function(e) {
                if (e.target.id === 'allTagsModal') {
                    closeAllTagsModal();
                }
            });
        }

        function closeAllTagsModal() {
            const modal = document.getElementById('allTagsModal');
            if (modal) {
                modal.remove();
            }
        }

        // ===================================
        // STATISTICS
        // ===================================
        function updateStatistics() {
            const statTotalDocs = document.getElementById('statTotalDocs');
            if (statTotalDocs) statTotalDocs.textContent = legislationData.length;
            
            const thisMonth = legislationData.filter(item => {
                const itemDate = new Date(item.createdAt || item.date);
                const now = new Date();
                return itemDate.getMonth() === now.getMonth() && 
                       itemDate.getFullYear() === now.getFullYear();
            }).length;
            
            const statThisMonth = document.getElementById('statThisMonth');
            if (statThisMonth) statThisMonth.textContent = thisMonth;
            
            const categories = [...new Set(legislationData.map(item => item.category))];
            const statCategories = document.getElementById('statCategories');
            if (statCategories) statCategories.textContent = categories.length;
            
            updateTypeChart();
            updateTimelineChart();
        }

        function updateTypeChart() {
            const ctx = document.getElementById('typeChart');
            if (!ctx) return;
            
            const types = {};
            legislationData.forEach(item => {
                const typeName = getTypeName(item.type);
                types[typeName] = (types[typeName] || 0) + 1;
            });
            
            if (typeChart) {
                typeChart.destroy();
            }
            
            typeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(types),
                    datasets: [{
                        label: 'Πλήθος',
                        data: Object.values(types),
                        backgroundColor: 'rgba(251, 133, 0, 0.8)',
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function updateTimelineChart() {
            const ctx = document.getElementById('timelineChart');
            if (!ctx) return;
            
            const years = {};
            legislationData.forEach(item => {
                try {
                    const year = new Date(item.date).getFullYear();
                    if (year && !isNaN(year)) {
                        years[year] = (years[year] || 0) + 1;
                    }
                } catch (e) {
                    console.error('Error parsing date:', item.date);
                }
            });
            
            const sortedYears = Object.keys(years).sort((a, b) => a - b);
            
            if (timelineChart) {
                timelineChart.destroy();
            }
            
            timelineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedYears,
                    datasets: [{
                        label: 'Νομοθεσίες',
                        data: sortedYears.map(year => years[year]),
                        borderColor: 'rgba(251, 133, 0, 1)',
                        backgroundColor: 'rgba(251, 133, 0, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // ===================================
        // THEME MANAGEMENT
        // ===================================
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            
            const themeIcon = document.getElementById('themeIcon');
            if (themeIcon) themeIcon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (darkModeToggle) darkModeToggle.checked = isDark;
            
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        function applyColorTheme() {
            const selectedTheme = document.querySelector('input[name="colorTheme"]:checked')?.value || 'blue';
            
            const themes = {
                blue: {
                    primary: '#0a2463',
                    primaryLight: '#1e3a8a',
                    accent: '#fb8500',
                    accentLight: '#ffb703'
                },
                green: {
                    primary: '#065f46',
                    primaryLight: '#047857',
                    accent: '#10b981',
                    accentLight: '#34d399'
                },
                purple: {
                    primary: '#5b21b6',
                    primaryLight: '#7c3aed',
                    accent: '#a855f7',
                    accentLight: '#c084fc'
                },
                red: {
                    primary: '#991b1b',
                    primaryLight: '#dc2626',
                    accent: '#ef4444',
                    accentLight: '#f87171'
                },
                teal: {
                    primary: '#0fa3b1',
                    primaryLight: '#0b7c86',
                    accent: '#40c9d4',
                    accentLight: '#5dd4e0'
                },
                coral: {
                    primary: '#ff6b6b',
                    primaryLight: '#ee5a52',
                    accent: '#ff8787',
                    accentLight: '#ffa0a0'
                },
                amber: {
                    primary: '#f59e0b',
                    primaryLight: '#d97706',
                    accent: '#fbbf24',
                    accentLight: '#fcd34d'
                },
                darkblue: {
                    primary: '#1e3a8a',
                    primaryLight: '#2563eb',
                    accent: '#dc2626',
                    accentLight: '#ef4444'
                }
            };
            
            const theme = themes[selectedTheme];
            if (theme) {
                document.documentElement.style.setProperty('--primary', theme.primary);
                document.documentElement.style.setProperty('--primary-light', theme.primaryLight);
                document.documentElement.style.setProperty('--accent', theme.accent);
                document.documentElement.style.setProperty('--accent-light', theme.accentLight);
                
                localStorage.setItem('colorTheme', selectedTheme);
            }
        }

        // ===================================
        // SEARCH IN TEXT
        // ===================================
        function searchInLegislationText() {
            const searchInput = document.getElementById('searchInText');
            if (!searchInput) return;
            
            const searchTerm = searchInput.value.trim();
            const clearBtn = document.getElementById('clearTextSearch');
            
            if (searchTerm) {
                if (clearBtn) clearBtn.classList.add('visible');
                performTextSearch(searchTerm);
            } else {
                if (clearBtn) clearBtn.classList.remove('visible');
                clearTextSearch();
            }
        }

        function performTextSearch(searchTerm) {
            if (!searchTerm || !currentLegislationId) {
                clearTextSearch();
                return;
            }
            
            const contentElement = document.getElementById('viewContent');
            if (!contentElement) return;
            
            const searchResultsInfo = document.getElementById('searchResultsInfo');
            
            clearTextSearch();
            
            const item = legislationData.find(item => item.id === currentLegislationId);
            if (!item) return;
            
            contentElement.innerHTML = item.content || '<p>Δεν υπάρχει περιεχόμενο</p>';
            
            try {
                const regex = new RegExp(`(${escapeRegExp(searchTerm)})`, 'gi');
                
                const walker = document.createTreeWalker(
                    contentElement,
                    NodeFilter.SHOW_TEXT,
                    null,
                    false
                );
                
                const textNodes = [];
                let node;
                while (node = walker.nextNode()) {
                    if (node.textContent.trim()) {
                        textNodes.push(node);
                    }
                }
                
                let matchCount = 0;
                textNodes.forEach(textNode => {
                    const matches = textNode.textContent.match(regex);
                    if (matches) {
                        const span = document.createElement('span');
                        span.innerHTML = textNode.textContent.replace(regex, (match, p1, offset) => {
                            const id = `highlight-${matchCount}`;
                            const className = matchCount === 0 ? 'highlight current' : 'highlight';
                            matchCount++;
                            return `<span class="${className}" id="${id}">${match}</span>`;
                        });
                        textNode.parentNode.replaceChild(span, textNode);
                    }
                });
                
                searchResults = Array.from(contentElement.querySelectorAll('.highlight'));
                currentResultIndex = 0;
                
                if (searchResults.length === 0) {
                    if (searchResultsInfo) {
                        searchResultsInfo.innerHTML = `<span style="color: var(--warning);"><i class="fas fa-exclamation-circle"></i> Δεν βρέθηκαν αποτελέσματα για "${searchTerm}"</span>`;
                        searchResultsInfo.style.display = 'block';
                    }
                } else {
                    if (searchResultsInfo) {
                        searchResultsInfo.innerHTML = `
                            <span style="color: var(--success);">
                                <i class="fas fa-search"></i> Βρέθηκαν ${searchResults.length} αποτελέσματα
                            </span>
                            ${searchResults.length > 1 ? `
                                <span style="margin-left: 10px;">
                                    <button onclick="navigateSearchResults(-1)" style="background: var(--border); border: none; padding: 4px 10px; border-radius: 5px; cursor: pointer; margin: 0 4px;" title="Προηγούμενο">
                                        <i class="fas fa-chevron-up"></i>
                                    </button>
                                    <span style="margin: 0 5px;" id="currentResultCounter">${currentResultIndex + 1} / ${searchResults.length}</span>
                                    <button onclick="navigateSearchResults(1)" style="background: var(--border); border: none; padding: 4px 10px; border-radius: 5px; cursor: pointer; margin: 0 4px;" title="Επόμενο">
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                </span>
                            ` : ''}
                        `;
                        searchResultsInfo.style.display = 'block';
                    }
                    
                    if (searchResults[0]) {
                        searchResults[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            } catch (e) {
                console.error('Search error:', e);
                showToast('Σφάλμα κατά την αναζήτηση: ' + e.message, 'error');
            }
        }

        function clearTextSearch() {
            const contentElement = document.getElementById('viewContent');
            if (!contentElement) return;
            
            const highlights = contentElement.querySelectorAll('.highlight');
            highlights.forEach(highlight => {
                const text = highlight.textContent;
                const textNode = document.createTextNode(text);
                highlight.parentNode.replaceChild(textNode, highlight);
            });
            
            contentElement.normalize();
            
            searchResults = [];
            currentResultIndex = -1;
            
            const searchResultsInfo = document.getElementById('searchResultsInfo');
            if (searchResultsInfo) {
                searchResultsInfo.style.display = 'none';
            }
            
            const clearBtn = document.getElementById('clearTextSearch');
            if (clearBtn) clearBtn.classList.remove('visible');
        }

        function navigateSearchResults(direction) {
            if (searchResults.length === 0) return;
            
            if (searchResults[currentResultIndex]) {
                searchResults[currentResultIndex].classList.remove('current');
            }
            
            currentResultIndex = (currentResultIndex + direction + searchResults.length) % searchResults.length;
            
            if (searchResults[currentResultIndex]) {
                searchResults[currentResultIndex].classList.add('current');
                searchResults[currentResultIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                const counter = document.getElementById('currentResultCounter');
                if (counter) {
                    counter.textContent = `${currentResultIndex + 1} / ${searchResults.length}`;
                }
            }
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // ===================================
        // TYPES AND CATEGORIES MANAGEMENT
        // ===================================
        function updateTypesList() {
            const container = document.getElementById('legislationTypesList');
            if (!container) return;
            
            container.innerHTML = Object.entries(customLegislationTypes)
                .map(([key, value]) => `
                    <div class="setting-list-item">
                        <span><strong>${key}</strong>: ${value}</span>
                        <button onclick="removeLegislationType('${key}')">
                            <i class="fas fa-trash"></i> Διαγραφή
                        </button>
                    </div>
                `).join('');
        }

        function updateCategoriesList() {
            const container = document.getElementById('categoriesList');
            if (!container) return;
            
            container.innerHTML = customCategories
                .map((category, index) => `
                    <div class="setting-list-item">
                        <span>${category}</span>
                        <button onclick="removeCategory(${index})">
                            <i class="fas fa-trash"></i> Διαγραφή
                        </button>
                    </div>
                `).join('');
        }

        function addLegislationType() {
            const input = document.getElementById('newLegislationType');
            if (!input) return;
            
            const value = input.value.trim();
            
            if (!value) {
                showToast('Εισάγετε όνομα τύπου', 'warning');
                return;
            }
            
            const key = value.toLowerCase().replace(/\s+/g, '_');
            
            if (customLegislationTypes[key]) {
                showToast('Ο τύπος υπάρχει ήδη', 'warning');
                return;
            }
            
            customLegislationTypes[key] = value;
            saveCustomTypesAndCategories();
            updateTypesList();
            input.value = '';
            showToast('Ο τύπος προστέθηκε επιτυχώς', 'success');
        }

        function removeLegislationType(key) {
            if (confirm('Είστε σίγουροι ότι θέλετε να διαγράψετε αυτόν τον τύπο;')) {
                delete customLegislationTypes[key];
                saveCustomTypesAndCategories();
                updateTypesList();
                showToast('Ο τύπος διαγράφηκε', 'info');
            }
        }

        function addCategory() {
            const input = document.getElementById('newCategory');
            if (!input) return;
            
            const value = input.value.trim();
            
            if (!value) {
                showToast('Εισάγετε όνομα κατηγορίας', 'warning');
                return;
            }
            
            if (customCategories.includes(value)) {
                showToast('Η κατηγορία υπάρχει ήδη', 'warning');
                return;
            }
            
            customCategories.push(value);
            saveCustomTypesAndCategories();
            updateCategoriesList();
            input.value = '';
            showToast('Η κατηγορία προστέθηκε επιτυχώς', 'success');
        }

        function removeCategory(index) {
            if (confirm('Είστε σίγουροι ότι θέλετε να διαγράψετε αυτήν την κατηγορία;')) {
                customCategories.splice(index, 1);
                saveCustomTypesAndCategories();
                updateCategoriesList();
                showToast('Η κατηγορία διαγράφηκε', 'info');
            }
        }

        // ===================================
        // DATA IMPORT/EXPORT
        // ===================================
        function exportData() {
            const dataToExport = legislationData.map(item => {
                return { ...item };
            });
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `astynomika-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 100);
            
            showToast('Τα δεδομένα εξήχθησαν επιτυχώς!', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) {
                    return;
                }
                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        
                        if (!Array.isArray(imported)) {
                            showToast('Το αρχείο δεν περιέχει έγκυρα δεδομένα (πρέπει να είναι πίνακας)', 'error');
                            return;
                        }
                        
                        legislationData = imported;
                        await saveData();
                        
                        const currentView = document.querySelector('.nav-link.active')?.dataset.view || 'dashboard';
                        showView(currentView);
                        
                        showToast(`Τα δεδομένα εισήχθησαν επιτυχώς! (${imported.length} εγγραφές)`, 'success');
                    } catch (error) {
                        console.error('Import error:', error);
                        showToast('Σφάλμα κατά την εισαγωγή δεδομένων: ' + error.message, 'error');
                    }
                };
                reader.onerror = () => {
                    showToast('Σφάλμα κατά την ανάγνωση του αρχείου', 'error');
                };
                reader.readAsText(file);
                };
                input.click();
                }
        
        async function clearAllData() {
            if (confirm('Είστε σίγουροι ότι θέλετε να διαγράψετε όλα τα δεδομένα;')) {
                legislationData = [];
                await saveData();
                showToast('Όλα τα δεδομένα διαγράφηκαν', 'info');
            }
        }

        // ===================================
        // UTILITY FUNCTIONS
        // ===================================
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
               clearTimeout(timeout);
               timeout = setTimeout(later, wait);
               };
          }
        
        // ===================================
        // TAGS FUNCTIONALITY
        // ===================================
        function addTagToForm() {
            const input = document.getElementById('legislationTagInput');
            if (!input) return;
            
            const tag = input.value.trim();
            
            if (tag && !currentTags.includes(tag)) {
                currentTags.push(tag);
                renderTagsInForm();
                input.value = '';
            }
        }

        function removeTagFromForm(tag) {
            currentTags = currentTags.filter(t => t !== tag);
            renderTagsInForm();
        }

        function renderTagsInForm() {
            const container = document.getElementById('legislationTagsDisplay');
            if (!container) return;
            
            container.innerHTML = currentTags.map(tag => `
                <span class="tag">
                    ${tag}
                    <button type="button" class="remove-tag" onclick="removeTagFromForm('${tag}')">
                        <i class="fas fa-times"></i>
                    </button>
                </span>
            `).join('');
        }

        // ===================================
        // FAVORITES FUNCTIONALITY
        // ===================================
        function toggleFavorite() {
            if (!currentLegislationId) return;
            
            const item = legislationData.find(l => l.id === currentLegislationId);
            if (!item) return;
            
            item.isFavorite = !item.isFavorite;
            saveData();
            updateFavoriteButton();
            updateDashboard();
            
            const message = item.isFavorite ? 'Προστέθηκε στα αγαπημένα ❤️' : 'Αφαιρέθηκε από τα αγαπημένα';
            showToast(message, item.isFavorite ? 'success' : 'info');
        }

        function updateFavoriteButton() {
            const btn = document.getElementById('favoriteBtn');
            if (!btn || !currentLegislationId) return;
            
            const item = legislationData.find(l => l.id === currentLegislationId);
            if (!item) return;
            
            const icon = btn.querySelector('i');
            if (item.isFavorite) {
                if (icon) icon.className = 'fas fa-heart';
                btn.classList.add('is-favorite');
                btn.title = 'Αφαίρεση από αγαπημένα';
            } else {
                if (icon) icon.className = 'far fa-heart';
                btn.classList.remove('is-favorite');
                btn.title = 'Προσθήκη στα αγαπημένα';
            }
        }

        function showFavorites() {
            const favorites = legislationData.filter(item => item.isFavorite);
            
            if (favorites.length === 0) {
                showToast('Δεν έχετε αγαπημένες νομοθεσίες ακόμα', 'info');
                return;
            }
            
            showView('legislation');
            
            const container = document.getElementById('legislationGrid');
            if (container) {
                renderLegislationCards(favorites, 'legislationGrid');
            }
            
            showToast(`Εμφάνιση ${favorites.length} αγαπημένων νομοθεσιών`, 'success');
        }

        // ===================================
        // BACKUP FUNCTION
        // ===================================
        function createBackup() {
            const backup = {
                data: legislationData,
                timestamp: new Date().toISOString(),
                version: '1.0',
                itemCount: legislationData.length
            };
            
            const backupStr = JSON.stringify(backup, null, 2);
            const blob = new Blob([backupStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `astynomika-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 100);
            
            showToast('Το backup δημιουργήθηκε επιτυχώς!', 'success');
        }

        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                e.preventDefault();
                createBackup();
            }
        });

        // ===================================
        // DEADLINES & REMINDERS
        // ===================================
        function checkDeadlines() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const upcoming = legislationData.filter(item => {
                if (!item.deadline) return false;
                try {
                    const deadline = new Date(item.deadline);
                    deadline.setHours(0, 0, 0, 0);
                    const days = Math.ceil((deadline - today) / (1000 * 60 * 60 * 24));
                    return days >= 0 && days <= 7;
                } catch (e) {
                    return false;
                }
            });
            
            if (upcoming.length > 0) {
                showToast(`⚠️ ${upcoming.length} προθεσμία/ες τις επόμενες 7 ημέρες!`, 'warning');
            }
            
            return upcoming;
        }

        function getDeadlineStatus(deadline) {
            if (!deadline) return null;
            try {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const d = new Date(deadline);
                d.setHours(0, 0, 0, 0);
                const days = Math.ceil((d - today) / (1000 * 60 * 60 * 24));
                
                if (days < 0) return { status: 'expired', text: 'Έληξε!', color: '#ef476f', icon: 'times-circle' };
                if (days === 0) return { status: 'today', text: 'Σήμερα!', color: '#ef476f', icon: 'exclamation-circle' };
                if (days <= 3) return { status: 'urgent', text: days + ' ημέρες', color: '#fb8500', icon: 'clock' };
                if (days <= 7) return { status: 'soon', text: days + ' ημέρες', color: '#ffb703', icon: 'clock' };
                return { status: 'normal', text: days + ' ημέρες', color: '#118ab2', icon: 'calendar-check' };
            } catch (e) {
                return { status: 'error', text: 'Λάθος ημερομηνία', color: '#ef476f', icon: 'times-circle' };
            }
        }

        // ===================================
        // ATTACHMENTS SYSTEM - COMPLETE VERSION
        // ===================================
        function handleFileInput() {
            const input = document.getElementById('fileInput');
            if (!input) return;
            
            input.onchange = (e) => {
                const files = e.target.files;
                for (let file of files) {
                    if (file.size > 5 * 1024 * 1024) {
                        showToast(`Το αρχείο "${file.name}" είναι πολύ μεγάλο (>5MB)`, 'error');
                        continue;
                    }
                    addAttachment(file);
                }
                input.value = '';
            };
        }

        function addAttachment(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                currentAttachments.push({
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    data: e.target.result,
                    uploadedAt: new Date().toISOString()
                });
                renderAttachments();
                showToast(`"${file.name}" προστέθηκε`, 'success');
            };
            reader.onerror = () => {
                showToast(`Σφάλμα ανάγνωσης "${file.name}"`, 'error');
            };
            reader.readAsDataURL(file);
        }

        function removeAttachment(index) {
            if (index >= 0 && index < currentAttachments.length) {
                const name = currentAttachments[index].name;
                currentAttachments.splice(index, 1);
                renderAttachments();
                showToast(`"${name}" αφαιρέθηκε`, 'info');
            }
        }

        function renderAttachments() {
            const container = document.getElementById('attachmentsList');
            if (!container) return;
            
            if (currentAttachments.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = currentAttachments.map((att, i) => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 10px; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0;">
                        <i class="fas fa-${getFileIcon(att.type)}" style="color: var(--accent); font-size: 18px;"></i>
                        <div style="min-width: 0; flex: 1;">
                            <div style="font-weight: 500; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${att.name}</div>
                            <div style="font-size: 11px; color: var(--text-secondary);">${formatFileSize(att.size)} • ${new Date(att.uploadedAt).toLocaleDateString('el-GR')}</div>
                        </div>
                    </div>
                    <button type="button" class="header-btn" onclick="removeAttachment(${i})" title="Αφαίρεση">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        function getFileIcon(type) {
            if (!type) return 'file';
            if (type.includes('pdf')) return 'file-pdf';
            if (type.includes('word') || type.includes('document')) return 'file-word';
            if (type.includes('excel') || type.includes('spreadsheet')) return 'file-excel';
            if (type.includes('image')) return 'file-image';
            if (type.includes('zip') || type.includes('rar') || type.includes('compressed')) return 'file-archive';
            if (type.includes('text')) return 'file-alt';
            return 'file';
        }

        function formatFileSize(bytes) {
            if (!bytes) return '0 B';
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function setupDragDrop() {
            const zone = document.getElementById('attachmentDropZone');
            if (!zone) return;
            
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                zone.style.borderColor = 'var(--accent)';
                zone.style.background = 'rgba(251, 133, 0, 0.05)';
            });
            
            zone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                zone.style.borderColor = 'var(--border)';
                zone.style.background = 'var(--bg-main)';
            });
            
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                e.stopPropagation();
                zone.style.borderColor = 'var(--border)';
                zone.style.background = 'var(--bg-main)';
                
                const files = e.dataTransfer.files;
                for (let file of files) {
                    if (file.size > 5 * 1024 * 1024) {
                        showToast(`"${file.name}" > 5MB`, 'error');
                        continue;
                    }
                    addAttachment(file);
                }
            });
        }

        // ===================================
        // DOWNLOAD ATTACHMENT FUNCTION
        // ===================================
        function downloadAttachment(legislationId, attachmentIndex) {
            const item = legislationData.find(item => item.id === legislationId);
            if (!item || !item.attachments || !item.attachments[attachmentIndex]) {
                showToast('Το συνημμένο δεν βρέθηκε', 'error');
                return;
            }
            
            const att = item.attachments[attachmentIndex];
            
            if (!att.data) {
                showToast('Δεν υπάρχουν δεδομένα για αυτό το αρχείο', 'error');
                return;
            }
            
            try {
                const byteCharacters = atob(att.data.split(',')[1]);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: att.type });
                
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = att.name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                setTimeout(() => {
                    window.URL.revokeObjectURL(url);
                }, 100);
                
                showToast(`Λήψη "${att.name}" ξεκίνησε`, 'success');
            } catch (error) {
                console.error('Download error:', error);
                showToast('Σφάλμα κατά τη λήψη: ' + error.message, 'error');
            }
        }

        // ===================================
        // KEYBOARD SHORTCUTS
        // ===================================
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                const searchInput = document.getElementById('searchInput');
                if (searchInput) searchInput.focus();
            }
            
            if (e.key === 'Escape') {
                closeModal();
                closeViewModal();
                closeTagsModal();
                closeAllTagsModal();
            }
        });

        console.log('✅ All fixes loaded: Tags are now clickable in 3 locations (dashboard, cards, view modal)');

        // ===================================
        // PWA SUPPORT
        // ===================================
        
        function generatePWAIcon(size) {
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            
            const gradient = ctx.createLinearGradient(0, 0, size, size);
            gradient.addColorStop(0, '#0a2463');
            gradient.addColorStop(1, '#fb8500');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, size, size);
            
            ctx.fillStyle = 'white';
            ctx.font = `bold ${size * 0.5}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('⚖️', size / 2, size / 2);
            
            return canvas.toDataURL('image/png');
        }

        function createPWAManifest() {
            const icon192 = generatePWAIcon(192);
            const icon512 = generatePWAIcon(512);
            
            const manifest = {
                name: "ΑστυΝομικά - Σύστημα Διαχείρισης Νομοθεσίας",
                short_name: "ΑστυΝομικά",
                description: "Ολοκληρωμένο σύστημα διαχείρισης και οργάνωσης αστυνομικής νομοθεσίας",
                start_url: "./",
                scope: "./",
                display: "standalone",
                background_color: "#0a2463",
                theme_color: "#0a2463",
                orientation: "portrait-primary",
                icons: [
                    { src: icon192, sizes: "192x192", type: "image/png", purpose: "any maskable" },
                    { src: icon512, sizes: "512x512", type: "image/png", purpose: "any maskable" }
                ]
            };
            
            const manifestJSON = JSON.stringify(manifest);
            const manifestDataURL = 'data:application/json;charset=utf-8,' + encodeURIComponent(manifestJSON);
            
            // Add manifest link
            let link = document.querySelector('link[rel="manifest"]');
            if (!link) {
                link = document.createElement('link');
                link.rel = 'manifest';
                document.head.appendChild(link);
            }
            link.href = manifestDataURL;
            
            // Add meta tags
            const metas = [
                { name: 'theme-color', content: '#0a2463' },
                { name: 'apple-mobile-web-app-capable', content: 'yes' },
                { name: 'apple-mobile-web-app-status-bar-style', content: 'black-translucent' },
                { name: 'apple-mobile-web-app-title', content: 'ΑστυΝομικά' },
                { name: 'mobile-web-app-capable', content: 'yes' }
            ];
            
            metas.forEach(m => {
                let meta = document.querySelector(`meta[name="${m.name}"]`);
                if (!meta) {
                    meta = document.createElement('meta');
                    meta.name = m.name;
                    meta.content = m.content;
                    document.head.appendChild(meta);
                }
            });
            
            // Add apple touch icon
            let appleIcon = document.querySelector('link[rel="apple-touch-icon"]');
            if (!appleIcon) {
                appleIcon = document.createElement('link');
                appleIcon.rel = 'apple-touch-icon';
                document.head.appendChild(appleIcon);
            }
            appleIcon.href = icon512;
            
            // Add regular icon
            let icon = document.querySelector('link[rel="icon"]');
            if (!icon) {
                icon = document.createElement('link');
                icon.rel = 'icon';
                document.head.appendChild(icon);
            }
            icon.href = icon192;
            
            console.log('✅ PWA Manifest created');
        }

        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                const swCode = `
                    const CACHE_NAME = 'astynomika-v1.0';
                    const urlsToCache = [
                        './',
                        './index.html'
                    ];

                    self.addEventListener('install', (event) => {
                        console.log('[SW] Installing...');
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => {
                                    console.log('[SW] Cache opened');
                                    return cache.addAll(urlsToCache);
                                })
                                .catch(err => console.log('[SW] Cache error:', err))
                        );
                        self.skipWaiting();
                    });

                    self.addEventListener('activate', (event) => {
                        console.log('[SW] Activating...');
                        event.waitUntil(
                            caches.keys().then((cacheNames) => {
                                return Promise.all(
                                    cacheNames.map((cacheName) => {
                                        if (cacheName !== CACHE_NAME) {
                                            console.log('[SW] Deleting old cache:', cacheName);
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            })
                        );
                        return self.clients.claim();
                    });

                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request).then((response) => {
                                        if (!response || response.status !== 200 || response.type !== 'basic') {
                                            return response;
                                        }
                                        const responseToCache = response.clone();
                                        caches.open(CACHE_NAME)
                                            .then((cache) => {
                                                cache.put(event.request, responseToCache);
                                            });
                                        return response;
                                    });
                                })
                                .catch(() => {
                                    return new Response('Offline - Η εφαρμογή λειτουργεί σε offline mode');
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swURL = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swURL, { scope: './' })
                    .then((registration) => {
                        console.log('✅ Service Worker registered:', registration.scope);
                        
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('[SW] New version found, installing...');
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('[SW] New version available, refresh to update');
                                }
                            });
                        });
                    })
                    .catch((err) => {
                        console.error('❌ Service Worker registration failed:', err);
                    });
            } else {
                console.log('ℹ️ Service Worker not supported');
            }
        }

        let deferredInstallPrompt = null;

        function showPWABanner() {
            // Remove any existing banner first
            const existingBanner = document.getElementById('pwa-install-banner');
            if (existingBanner) {
                existingBanner.remove();
            }

            const banner = document.createElement('div');
            banner.id = 'pwa-install-banner';
            banner.style.cssText = `
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #0a2463, #fb8500);
                color: white;
                padding: 20px;
                display: flex;
                align-items: center;
                gap: 16px;
                box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
                z-index: 999999;
                animation: slideUpBanner 0.4s ease-out;
                font-family: var(--font-body);
            `;
            
            banner.innerHTML = `
                <style>
                    @keyframes slideUpBanner {
                        from { transform: translateY(100%); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    @media (max-width: 768px) {
                        #pwa-install-banner { flex-direction: column; text-align: center; }
                        #pwa-install-banner > div:last-child { width: 100%; }
                        #pwa-install-banner button { width: 100%; margin: 4px 0; }
                    }
                </style>
                <div style="flex: 1;">
                    <div style="font-weight: 700; font-size: 18px; margin-bottom: 6px;">
                        📱 Προσθήκη στην Αρχική Οθόνη
                    </div>
                    <div style="font-size: 14px; opacity: 0.95;">
                        Εγκαταστήστε την εφαρμογή για γρήγορη πρόσβαση και offline χρήση
                    </div>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="pwa-install-btn" style="
                        padding: 12px 24px;
                        border: none;
                        border-radius: 8px;
                        font-weight: 700;
                        font-size: 15px;
                        background: white;
                        color: #0a2463;
                        cursor: pointer;
                        transition: all 0.2s;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    ">
                        <i class="fas fa-download"></i> Εγκατάσταση
                    </button>
                    <button id="pwa-dismiss-btn" style="
                        padding: 12px 24px;
                        border: 2px solid white;
                        background: transparent;
                        color: white;
                        border-radius: 8px;
                        font-weight: 700;
                        font-size: 15px;
                        cursor: pointer;
                        transition: all 0.2s;
                    ">
                        Όχι τώρα
                    </button>
                </div>
            `;
            
            document.body.appendChild(banner);
            
            document.getElementById('pwa-install-btn').addEventListener('click', async () => {
                if (deferredInstallPrompt) {
                    deferredInstallPrompt.prompt();
                    const result = await deferredInstallPrompt.userChoice;
                    console.log('Install result:', result.outcome);
                    if (result.outcome === 'accepted') {
                        showToast('Εφαρμογή εγκαταστάθηκε!', 'success');
                    }
                    deferredInstallPrompt = null;
                } else {
                    // Fallback για iOS
                    alert('Για εγκατάσταση:\n\niOS: Πατήστε το κουμπί Share (⬆️) και επιλέξτε "Add to Home Screen"\n\nAndroid: Χρησιμοποιήστε το μενού του browser (⋮) και επιλέξτε "Install app"');
                }
                banner.remove();
            });
            
            document.getElementById('pwa-dismiss-btn').addEventListener('click', () => {
                banner.remove();
                // Banner can be shown again from settings
            });
            
            console.log('✅ PWA Banner shown');
        }

        // Listen for install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt fired!');
            e.preventDefault();
            deferredInstallPrompt = e;
            
            // Banner is now manual - triggered from settings
            // setTimeout(showPWABanner, 2000);
        });

        // Check if already installed
        window.addEventListener('appinstalled', () => {
            console.log('✅ PWA installed successfully');
            deferredInstallPrompt = null;
        });

        // Detect if running as PWA
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
            console.log('🚀 Running as installed PWA');
        }

        // Initialize PWA
        function initPWA() {
            createPWAManifest();
            registerServiceWorker();
            
            // Banner is now manual - triggered from settings
            // For iOS - banner can be shown manually from settings
        }

        // Start PWA setup
        initPWA();

        // Make showPWABanner globally accessible
        window.showPWABanner = showPWABanner;
    </script>
</body>
</html>
